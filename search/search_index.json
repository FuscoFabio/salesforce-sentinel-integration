{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Integrazione Salesforce - Azure Sentinel","text":"<p>Benvenuto nella documentazione completa per integrare i log di accesso di Salesforce con Azure Sentinel.</p>"},{"location":"#panoramica","title":"Panoramica","text":"<p>Questo progetto fornisce soluzioni complete per trasferire automaticamente i log di accesso generati da Salesforce verso Azure Sentinel, creando un'unica piattaforma centralizzata per il monitoraggio della sicurezza.</p>"},{"location":"#inizia-qui","title":"Inizia Qui","text":""},{"location":"#quick-start","title":"\ud83d\ude80 Quick Start","text":"<p>Vuoi iniziare subito? Segui la guida rapida per configurare l'integrazione in pochi minuti.</p>"},{"location":"#documentazione","title":"\ud83d\udcda Documentazione","text":"<ul> <li>Introduzione - Scopri cos'\u00e8 questa integrazione e perch\u00e9 \u00e8 utile</li> <li>Soluzioni - Confronta le 5 soluzioni disponibili</li> <li>Setup - Configura Salesforce e Azure Sentinel</li> <li>Implementazione - Guide tecniche dettagliate</li> <li>Troubleshooting - Risolvi problemi comuni</li> </ul>"},{"location":"#soluzioni-disponibili","title":"Soluzioni Disponibili","text":"<p>Il progetto offre 5 soluzioni diverse per soddisfare ogni esigenza:</p> <ol> <li>CCF - Setup rapido, zero manutenzione \u2b50 Consigliato</li> <li>Azure Function - Massima personalizzazione</li> <li>Logic App - Approccio low-code visuale</li> <li>Syslog - Per infrastrutture esistenti</li> <li>Third-party - Soluzioni enterprise</li> </ol>"},{"location":"#vantaggi-principali","title":"Vantaggi Principali","text":"<ul> <li>\u2705 Visibilit\u00e0 Centralizzata: Tutti i log di accesso in un'unico posto</li> <li>\u2705 Analisi Avanzata: Query KQL per identificare pattern sospetti</li> <li>\u2705 Alerting Automatico: Notifiche per accessi anomali</li> <li>\u2705 Compliance: Tracciamento completo degli accessi per audit</li> <li>\u2705 Correlazione Eventi: Integrare con altri log di sicurezza</li> </ul>"},{"location":"#prerequisiti","title":"Prerequisiti","text":""},{"location":"#salesforce","title":"Salesforce","text":"<ul> <li>Licenza Enterprise, Unlimited o Performance Edition</li> <li>Event Monitoring abilitato</li> <li>Permessi per creare Connected App</li> </ul>"},{"location":"#azure","title":"Azure","text":"<ul> <li>Sottoscrizione Azure attiva</li> <li>Azure Sentinel Workspace</li> <li>Permessi per creare risorse Azure</li> </ul>"},{"location":"#link-utili","title":"Link Utili","text":"<ul> <li>\ud83d\udcd6 Documentazione Completa</li> <li>\ud83d\udd27 API Reference</li> <li>\ud83d\udd17 Link Utili</li> <li>\ud83d\udc1b Troubleshooting</li> </ul>"},{"location":"#repository","title":"Repository","text":"<ul> <li>GitHub: salesforce-sentinel-integration</li> <li>Documentazione: https://FuscoFabio.github.io/salesforce-sentinel-integration/</li> </ul> <p>Pronto per iniziare? Inizia con il Quick Start o esplora le soluzioni disponibili.</p>"},{"location":"CCF_CODELESS_CONNECTOR/","title":"CodeLess Connector Framework (CCF)","text":"<p>Documentazione completa del CodeLess Connector Framework per l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"CCF_CODELESS_CONNECTOR/#panoramica","title":"Panoramica","text":"<p>Il CodeLess Connector Framework (CCF) \u00e8 la soluzione raccomandata per setup rapido senza codice.</p>"},{"location":"CCF_CODELESS_CONNECTOR/#configurazione","title":"Configurazione","text":"<p>Vedi la documentazione completa nel repository per i dettagli di configurazione.</p>"},{"location":"CCF_CODELESS_CONNECTOR/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione Microsoft</li> <li>Guida Setup</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Guida per risolvere i problemi comuni nell'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"troubleshooting/#problemi-comuni","title":"Problemi Comuni","text":""},{"location":"troubleshooting/#nessun-dato-in-azure-sentinel","title":"Nessun Dato in Azure Sentinel","text":"<p>Sintomi: Non vedi eventi Salesforce in Log Analytics.</p> <p>Possibili Cause e Soluzioni:</p> <ol> <li>Event Monitoring non attivo abbastanza a lungo</li> <li>Event Monitoring richiede 24-48 ore per generare eventi</li> <li> <p>Soluzione: Attendi e verifica dopo 48 ore</p> </li> <li> <p>Credenziali OAuth non valide</p> </li> <li>Consumer Key o Secret errati</li> <li> <p>Soluzione: Verifica le credenziali nella Connected App</p> </li> <li> <p>Connector/Function/Logic App non configurato correttamente</p> </li> <li>Configurazione incompleta o errata</li> <li> <p>Soluzione: Rivedi la configurazione passo per passo</p> </li> <li> <p>Permessi insufficienti</p> </li> <li>L'utente non ha permessi per Event Log Files</li> <li> <p>Soluzione: Verifica Permission Sets e profili</p> </li> <li> <p>Problemi di rete/firewall</p> </li> <li>IP bloccati o restrizioni di rete</li> <li>Soluzione: Verifica Network Access in Salesforce e range IP Azure</li> </ol>"},{"location":"troubleshooting/#errori-di-autenticazione","title":"Errori di Autenticazione","text":"<p>Sintomi: Errori 401 Unauthorized o problemi di login.</p> <p>Possibili Cause e Soluzioni:</p> <ol> <li>Token OAuth scaduto</li> <li>I token hanno una scadenza</li> <li> <p>Soluzione: Implementa refresh token automatico</p> </li> <li> <p>Consumer Secret errato</p> </li> <li>Secret copiato incorrettamente</li> <li> <p>Soluzione: Rigenera il Consumer Secret se necessario</p> </li> <li> <p>Callback URL non corrispondente</p> </li> <li>URL nella Connected App non corrisponde</li> <li> <p>Soluzione: Verifica e aggiorna il Callback URL</p> </li> <li> <p>OAuth Scopes insufficienti</p> </li> <li>Scopes mancanti nella Connected App</li> <li>Soluzione: Aggiungi gli scopes necessari</li> </ol>"},{"location":"troubleshooting/#dati-incompleti-o-mancanti","title":"Dati Incompleti o Mancanti","text":"<p>Sintomi: Solo alcuni eventi vengono ricevuti, altri mancano.</p> <p>Possibili Cause e Soluzioni:</p> <ol> <li>Filtri troppo restrittivi</li> <li>Filtri che escludono eventi</li> <li> <p>Soluzione: Rivedi i filtri nella soluzione</p> </li> <li> <p>Eventi non ancora disponibili</p> </li> <li>Event Monitoring ha delay</li> <li> <p>Soluzione: Verifica la data degli eventi richiesti</p> </li> <li> <p>Rate Limits raggiunti</p> </li> <li>Troppe richieste API</li> <li> <p>Soluzione: Implementa retry con backoff esponenziale</p> </li> <li> <p>Errori durante il processing</p> </li> <li>Errori silenziosi nella trasformazione</li> <li>Soluzione: Controlla i log della soluzione</li> </ol>"},{"location":"troubleshooting/#errori-nella-functionlogic-app","title":"Errori nella Function/Logic App","text":"<p>Sintomi: Errori nelle esecuzioni della Function o Logic App.</p> <p>Possibili Cause e Soluzioni:</p> <ol> <li>Application Settings mancanti</li> <li>Variabili d'ambiente non configurate</li> <li> <p>Soluzione: Verifica tutte le Application Settings</p> </li> <li> <p>Timeout delle richieste</p> </li> <li>Richieste che impiegano troppo tempo</li> <li> <p>Soluzione: Ottimizza il codice o aumenta il timeout</p> </li> <li> <p>Errori di parsing JSON</p> </li> <li>Formato dati non valido</li> <li> <p>Soluzione: Verifica lo schema dei dati</p> </li> <li> <p>Problemi di connessione</p> </li> <li>Problemi di rete temporanei</li> <li>Soluzione: Implementa retry logic robusto</li> </ol>"},{"location":"troubleshooting/#costi-elevati","title":"Costi Elevati","text":"<p>Sintomi: Costi Azure pi\u00f9 alti del previsto.</p> <p>Possibili Cause e Soluzioni:</p> <ol> <li>Troppa ingestione dati</li> <li>Volume eventi superiore alle aspettative</li> <li> <p>Soluzione: Filtra eventi non necessari, ottimizza la frequenza</p> </li> <li> <p>Function eseguita troppo spesso</p> </li> <li>Timer trigger con frequenza eccessiva</li> <li> <p>Soluzione: Riduci la frequenza di esecuzione</p> </li> <li> <p>Retention troppo lunga</p> </li> <li>Dati conservati pi\u00f9 a lungo del necessario</li> <li>Soluzione: Riduci il periodo di retention</li> </ol>"},{"location":"troubleshooting/#diagnostica","title":"Diagnostica","text":""},{"location":"troubleshooting/#verifiche-step-by-step","title":"Verifiche Step-by-Step","text":"<ol> <li>Verifica Event Monitoring in Salesforce <pre><code>Setup \u2192 Event Monitoring \u2192 Event Log Files\n</code></pre></li> <li>Controlla che ci siano eventi recenti</li> <li> <p>Verifica i tipi di evento disponibili</p> </li> <li> <p>Verifica Connected App <pre><code>Setup \u2192 App Manager \u2192 [Your Connected App]\n</code></pre></p> </li> <li>Verifica che sia attiva</li> <li>Controlla OAuth Settings</li> <li> <p>Verifica Callback URL</p> </li> <li> <p>Verifica Credenziali</p> </li> <li>Testa le credenziali con una chiamata API manuale</li> <li> <p>Usa Postman o curl per verificare</p> </li> <li> <p>Verifica Log Analytics <pre><code>Salesforce_CL\n| take 10\n</code></pre></p> </li> <li>Esegui query per verificare dati</li> <li> <p>Controlla schema e campi</p> </li> <li> <p>Verifica Function/Logic App Logs</p> </li> <li>Controlla Application Insights</li> <li>Verifica errori e eccezioni</li> <li>Controlla metriche di esecuzione</li> </ol>"},{"location":"troubleshooting/#query-di-diagnostica","title":"Query di Diagnostica","text":"<p>Verifica ultimi eventi: <pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| order by TimeGenerated desc\n| take 10\n</code></pre></p> <p>Conta eventi per tipo: <pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(24h)\n| summarize count() by EventType_s\n</code></pre></p> <p>Verifica errori: <pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(24h)\n| where isnotempty(Error_s)\n| project TimeGenerated, Error_s, UserName_s\n</code></pre></p>"},{"location":"troubleshooting/#log-e-monitoraggio","title":"Log e Monitoraggio","text":""},{"location":"troubleshooting/#application-insights","title":"Application Insights","text":"<p>Configura Application Insights per: - Tracciare esecuzioni - Monitorare errori - Analizzare performance - Configurare alert</p>"},{"location":"troubleshooting/#log-di-salesforce","title":"Log di Salesforce","text":"<p>Controlla i log in Salesforce: - Setup \u2192 Debug Logs - Setup \u2192 Event Monitoring \u2192 Event Log Files</p>"},{"location":"troubleshooting/#log-di-azure","title":"Log di Azure","text":"<p>Controlla i log in Azure: - Function App \u2192 Log stream - Logic App \u2192 Run history - Log Analytics \u2192 Logs</p>"},{"location":"troubleshooting/#supporto","title":"Supporto","text":"<p>Se il problema persiste:</p> <ol> <li>Raccogli informazioni:</li> <li>Screenshot degli errori</li> <li>Log rilevanti</li> <li> <p>Configurazione (senza credenziali)</p> </li> <li> <p>Consulta:</p> </li> <li>Link Utili</li> <li>API Reference</li> <li> <p>Community e forum</p> </li> <li> <p>Verifica:</p> </li> <li>Documentazione ufficiale</li> <li>Changelog e aggiornamenti</li> <li>Known issues</li> </ol>"},{"location":"troubleshooting/#best-practices-per-prevenire-problemi","title":"Best Practices per Prevenire Problemi","text":"<ol> <li>Monitoraggio Proattivo: Configura alert per errori</li> <li>Logging Completo: Logga tutte le operazioni importanti</li> <li>Test Regolari: Verifica periodicamente che l'integrazione funzioni</li> <li>Documentazione: Mantieni documentazione aggiornata della configurazione</li> <li>Backup: Mantieni backup delle configurazioni</li> <li>Versioning: Usa versioning per il codice delle Function</li> </ol>"},{"location":"implementation/azure-function/","title":"Implementazione Azure Function","text":"<p>Guida completa per implementare l'integrazione Salesforce-Azure Sentinel usando Azure Function.</p>"},{"location":"implementation/azure-function/#panoramica","title":"Panoramica","text":"<p>Azure Function permette di creare una soluzione serverless personalizzata per recuperare eventi da Salesforce e inviarli a Azure Sentinel tramite Log Analytics.</p>"},{"location":"implementation/azure-function/#architettura","title":"Architettura","text":"<pre><code>Salesforce Event Log Files API\n    \u2193\nAzure Function (Timer Trigger)\n    \u2193\nTrasformazione Dati\n    \u2193\nLog Analytics Data Collector API\n    \u2193\nAzure Sentinel\n</code></pre>"},{"location":"implementation/azure-function/#prerequisiti","title":"Prerequisiti","text":"<ul> <li>Azure Subscription</li> <li>Azure Function App (Consumption o Premium Plan)</li> <li>Log Analytics Workspace con Azure Sentinel</li> <li>Credenziali Salesforce (Consumer Key/Secret)</li> <li>Workspace ID e Primary Key di Log Analytics</li> <li>\u2b50 Raccomandato: Virtual Network per Private Endpoints (vedi Gestione Network e Sicurezza)</li> </ul>"},{"location":"implementation/azure-function/#passo-1-creare-azure-function-app","title":"Passo 1: Creare Azure Function App","text":"<ol> <li>Nel portale Azure, cerca \"Function App\"</li> <li>Clicca su Create</li> <li>Configura:</li> <li>Subscription: Seleziona la sottoscrizione</li> <li>Resource Group: Crea o seleziona un resource group</li> <li>Function App name: Nome univoco</li> <li>Publish: Code</li> <li>Runtime stack: .NET, Node.js, Python o PowerShell</li> <li>Version: Versione pi\u00f9 recente</li> <li>Region: Seleziona una regione</li> <li>Plan Type: <ul> <li>Consumption (per iniziare)</li> <li>Premium (per Private Endpoints e VNet Integration)</li> </ul> </li> <li>Clicca su Review + Create \u2192 Create</li> </ol>"},{"location":"implementation/azure-function/#configurazione-network-consigliato","title":"\u2b50 Configurazione Network (Consigliato)","text":"<p>Per massima sicurezza, configura Private Endpoints:</p> <ol> <li>Crea Virtual Network (se non esiste):</li> <li>Azure Portal \u2192 Virtual Networks \u2192 Create</li> <li>Name: <code>vnet-salesforce-integration</code></li> <li>Address Space: <code>10.0.0.0/16</code></li> <li> <p>Subnet: <code>subnet-functions</code> (10.0.1.0/24)</p> </li> <li> <p>Configura VNet Integration:</p> </li> <li>Function App \u2192 Networking \u2192 VNet integration</li> <li>Seleziona la VNet e subnet create</li> <li> <p>Abilita \"Route All\" se necessario</p> </li> <li> <p>Crea Private Endpoint:</p> </li> <li>Function App \u2192 Networking \u2192 Private endpoints \u2192 Add</li> <li>Connetti alla VNet</li> <li> <p>Configura Azure Private DNS Zone</p> </li> <li> <p>Configura Salesforce:</p> </li> <li>Usa l'IP privato del Private Endpoint</li> <li>In Salesforce, imposta IP Relaxation: \"Relax IP restrictions\" (non necessario con Private Endpoint)</li> </ol> <p>Alternativa - Range IP Pubblici: - Vedi Gestione Network e Sicurezza per configurare range IP pubblici - Richiede manutenzione periodica (range IP cambiano settimanalmente)</p>"},{"location":"implementation/azure-function/#passo-2-configurare-application-settings","title":"Passo 2: Configurare Application Settings","text":"<p>Nella Function App, vai a Configuration \u2192 Application settings e aggiungi:</p> <pre><code>Salesforce__ConsumerKey=&lt;your-consumer-key&gt;\nSalesforce__ConsumerSecret=&lt;your-consumer-secret&gt;\nSalesforce__Username=&lt;salesforce-username&gt;\nSalesforce__Password=&lt;salesforce-password&gt;\nSalesforce__SecurityToken=&lt;security-token&gt;\nLogAnalytics__WorkspaceId=&lt;workspace-id&gt;\nLogAnalytics__WorkspaceKey=&lt;workspace-key&gt;\n</code></pre> <p>Nota: Per sicurezza, usa Key Vault References invece di valori in chiaro.</p>"},{"location":"implementation/azure-function/#passo-3-implementare-la-function","title":"Passo 3: Implementare la Function","text":""},{"location":"implementation/azure-function/#timer-trigger-function","title":"Timer Trigger Function","text":"<p>Crea una Function con Timer Trigger che esegue periodicamente (es. ogni 15 minuti):</p> <pre><code>[FunctionName(\"SalesforceToSentinel\")]\npublic static async Task Run(\n    [TimerTrigger(\"0 */15 * * * *\")] TimerInfo myTimer,\n    ILogger log)\n{\n    // Recupera eventi da Salesforce\n    // Trasforma i dati\n    // Invia a Log Analytics\n}\n</code></pre>"},{"location":"implementation/azure-function/#logica-di-recupero-eventi","title":"Logica di Recupero Eventi","text":"<ol> <li>Autenticazione OAuth con Salesforce</li> <li>Recupero Event Log Files tramite API</li> <li>Filtraggio eventi gi\u00e0 processati (usando timestamp)</li> <li>Trasformazione dati in formato Log Analytics</li> </ol>"},{"location":"implementation/azure-function/#invio-a-log-analytics","title":"Invio a Log Analytics","text":"<p>Usa l'API Data Collector di Log Analytics per inviare i dati:</p> <pre><code>var json = JsonConvert.SerializeObject(logEntries);\nvar content = new StringContent(json, Encoding.UTF8, \"application/json\");\nvar signature = BuildSignature(json, workspaceKey);\nclient.DefaultRequestHeaders.Add(\"Log-Type\", \"Salesforce_CL\");\nclient.DefaultRequestHeaders.Add(\"x-ms-date\", DateTime.UtcNow.ToString(\"r\"));\nclient.DefaultRequestHeaders.Add(\"Authorization\", signature);\nawait client.PostAsync(workspaceUrl, content);\n</code></pre>"},{"location":"implementation/azure-function/#passo-4-gestione-errori-e-retry","title":"Passo 4: Gestione Errori e Retry","text":"<p>Implementa: - Retry Logic: Per errori temporanei - Dead Letter Queue: Per eventi non processabili - Logging: Per monitoraggio e troubleshooting - Checkpointing: Per tracciare eventi gi\u00e0 processati</p>"},{"location":"implementation/azure-function/#passo-5-monitoraggio","title":"Passo 5: Monitoraggio","text":"<p>Configura: - Application Insights: Per metriche e log - Alert: Per errori e problemi - Dashboard: Per visualizzare lo stato dell'integrazione</p>"},{"location":"implementation/azure-function/#esempio-di-schema-dati","title":"Esempio di Schema Dati","text":"<pre><code>{\n  \"TimeGenerated\": \"2024-01-15T10:30:00Z\",\n  \"EventType\": \"LoginEvent\",\n  \"UserName\": \"user@example.com\",\n  \"SourceIP\": \"192.168.1.1\",\n  \"Browser\": \"Chrome\",\n  \"Platform\": \"Windows\",\n  \"LoginType\": \"Web\",\n  \"Success\": true\n}\n</code></pre>"},{"location":"implementation/azure-function/#ottimizzazioni","title":"Ottimizzazioni","text":"<ul> <li>Batch Processing: Raggruppa pi\u00f9 eventi in una singola chiamata</li> <li>Parallel Processing: Processa pi\u00f9 eventi in parallelo</li> <li>Caching: Cache token OAuth per ridurre chiamate</li> <li>Cost Optimization: Usa Consumption Plan per costi ottimali</li> </ul>"},{"location":"implementation/azure-function/#limitazioni-e-polling","title":"Limitazioni e Polling","text":""},{"location":"implementation/azure-function/#timer-trigger-azure-function","title":"Timer Trigger (Azure Function)","text":"<ul> <li>Intervallo minimo supportato: 1 minuto (<code>0 */1 * * * *</code>) su Consumption e Premium Plan  </li> <li>Intervalli inferiori al minuto: Richiedono App Service Plan dedicato con <code>TimerTrigger</code> in modalit\u00e0 Continuous (sconsigliato per Salesforce)  </li> <li>Intervallo massimo consigliato: 60 minuti (per evitare ingestione massiva di backlog)  </li> <li>Accuratezza: Il timer non garantisce esecuzione al millisecondo; pu\u00f2 avere ritardi di 1-2 minuti</li> </ul>"},{"location":"implementation/azure-function/#strategia-di-polling-per-salesforce","title":"Strategia di Polling per Salesforce","text":"<ul> <li>Intervallo consigliato: 5-15 minuti (allinea latenza e consumo API)  </li> <li>Intervallo minimo raccomandato: 5 minuti per evitare rate limiting  </li> <li>Intervallo massimo raccomandato: 30 minuti se il volume di eventi \u00e8 moderato</li> </ul>"},{"location":"implementation/azure-function/#calcolo-dellintervallo-ottimale","title":"Calcolo dell'Intervallo Ottimale","text":"<pre><code>Intervallo (min) = (Eventi_giornalieri / Eventi_per_poll) \u00d7 (1440 / Richieste_API_disponibili)\n</code></pre> <p>Esempio: - Eventi giornalieri: 40.000 - Eventi elaborati per poll: 8.000 - Limite API disponibile: 15.000 richieste/24h</p> <pre><code>Intervallo = (40.000 / 8.000) \u00d7 (1440 / 15.000) = 0,48 minuti\n</code></pre> <p>In questo scenario: - Usa l'intervallo minimo di 5 minuti (limite pratico consigliato) - Abilita filtri sugli eventi non necessari - Valuta l'uso di una Function dedicata in Premium Plan</p>"},{"location":"implementation/azure-function/#limiti-salesforce-da-considerare","title":"Limiti Salesforce da Considerare","text":"<ul> <li>API Requests (24h rolling):  </li> <li>Enterprise: ~15.000  </li> <li>Unlimited: ~100.000  </li> <li>Performance: ~50.000  </li> <li>Request simultanee: 25  </li> <li>Disponibilit\u00e0 Event Log Files: 24-48 ore dopo l'evento</li> </ul>"},{"location":"implementation/azure-function/#suggerimenti-operativi","title":"Suggerimenti Operativi","text":"<ol> <li>Logica di checkpoint: salva l'ultimo <code>LogDate</code> processato per evitare duplicati  </li> <li>Backoff esponenziale: in caso di <code>HTTP 429</code> o <code>REQUEST_LIMIT_EXCEEDED</code> aumenta temporaneamente l'intervallo  </li> <li>Monitoraggio: usa Application Insights per verificare la durata effettiva del timer  </li> <li>Alert: crea alert se la Function non gira entro l'intervallo previsto (heart-beat)</li> </ol>"},{"location":"implementation/azure-function/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Errori di autenticazione: Verifica credenziali e token</li> <li>Nessun dato: Controlla timer trigger e log</li> <li>Errori API: Verifica rate limits e retry logic</li> <li>Costi elevati: Ottimizza frequenza esecuzione e batch size</li> </ul>"},{"location":"implementation/azure-function/#link-utili","title":"Link Utili","text":"<ul> <li>Azure Functions Documentation</li> <li>Log Analytics Data Collector API</li> <li>Salesforce Event Log Files API</li> </ul>"},{"location":"implementation/ccf/","title":"Implementazione CCF","text":"<p>Guida completa passo-passo per implementare l'integrazione Salesforce-Azure Sentinel usando il CodeLess Connector Framework (CCF).</p>"},{"location":"implementation/ccf/#panoramica","title":"Panoramica","text":"<p>Il CodeLess Connector Framework (CCF) \u00e8 la soluzione pi\u00f9 semplice per integrare Salesforce con Azure Sentinel. Non richiede codice, solo configurazione tramite interfaccia grafica.</p>"},{"location":"implementation/ccf/#architettura","title":"Architettura","text":"<pre><code>Salesforce Event Monitoring\n    \u2193\nCCF Connector (Azure Sentinel)\n    \u2193\nLog Analytics Workspace\n    \u2193\nAzure Sentinel\n</code></pre>"},{"location":"implementation/ccf/#prerequisiti","title":"Prerequisiti","text":"<ul> <li>Sottoscrizione Azure attiva</li> <li>Azure Sentinel Workspace configurato</li> <li>Licenza Salesforce Enterprise, Unlimited o Performance Edition</li> <li>Event Monitoring abilitato in Salesforce</li> <li>Connected App creata in Salesforce con OAuth</li> <li>Consumer Key e Consumer Secret di Salesforce</li> </ul>"},{"location":"implementation/ccf/#caso-desempio-completo","title":"Caso d'Esempio Completo","text":""},{"location":"implementation/ccf/#scenario","title":"Scenario","text":"<p>Un'organizzazione vuole monitorare tutti gli accessi a Salesforce per: - Rilevare accessi sospetti - Tracciare accessi da IP non usuali - Monitorare attivit\u00e0 fuori orario - Generare alert per tentativi di login falliti</p>"},{"location":"implementation/ccf/#passo-1-preparazione-salesforce","title":"Passo 1: Preparazione Salesforce","text":""},{"location":"implementation/ccf/#11-abilitare-event-monitoring","title":"1.1 Abilitare Event Monitoring","text":"<ol> <li>Accedi a Salesforce come amministratore</li> <li>Vai a Setup \u2192 Cerca \"Event Monitoring\"</li> <li>Vai a Event Monitoring Settings</li> <li>Abilita Event Monitoring se non gi\u00e0 attivo</li> <li>Verifica che Event Log Files sia abilitato</li> </ol>"},{"location":"implementation/ccf/#12-creare-connected-app","title":"1.2 Creare Connected App","text":"<ol> <li>Vai a Setup \u2192 App Manager</li> <li>Clicca su New Connected App</li> <li>Compila i campi:    <pre><code>Connected App Name: Azure Sentinel Integration\nAPI Name: Azure_Sentinel_Integration\nContact Email: admin@example.com\n</code></pre></li> <li>Abilita Enable OAuth Settings</li> <li>Configura Callback URL:     <pre><code>https://login.microsoftonline.com/common/oauth2/nativeclient\n</code></pre>    (Questo sar\u00e0 aggiornato dopo la configurazione del connector)</li> <li>Seleziona OAuth Scopes:</li> <li><code>Manage user data via APIs (api)</code></li> <li><code>Perform requests on your behalf at any time (refresh_token, offline_access)</code></li> <li><code>Access the identity URL service (id, profile, email, address, phone)</code></li> <li>Abilita Require Secret for Web Server Flow</li> <li>Salva e attendi 2-5 minuti per la propagazione</li> </ol>"},{"location":"implementation/ccf/#13-ottenere-credenziali","title":"1.3 Ottenere Credenziali","text":"<ol> <li>Vai alla Connected App appena creata</li> <li>Clicca su Manage \u2192 Edit Policies</li> <li>Configura:</li> <li>Permitted Users: \"All users may self-authorize\"</li> <li>IP Relaxation: <ul> <li>Se usi Private Endpoints: \"Relax IP restrictions\" (non necessario)</li> <li>Se usi Range IP pubblici: \"Enforce IP restrictions\" e configura Trusted IP Ranges</li> </ul> </li> <li>Vai a API (Enable OAuth Settings) \u2192 View</li> <li>Salva immediatamente:</li> <li>Consumer Key (Client ID): <code>3MVG9...</code> (esempio)</li> <li>Consumer Secret (Client Secret): <code>ABC123...</code> (esempio)</li> </ol> <p>\u26a0\ufe0f IMPORTANTE: Il Consumer Secret viene mostrato solo una volta!</p>"},{"location":"implementation/ccf/#14-configurare-network-access-se-necessario","title":"1.4 Configurare Network Access (Se Necessario)","text":"<p>\u2b50 Raccomandazione: Se possibile, usa Azure Private Link per Log Analytics invece di configurare range IP pubblici.</p> <p>Opzione A: Usa Private Link (Consigliato) 1. Configura Azure Private Link per il Log Analytics Workspace 2. Il CCF invier\u00e0 dati tramite Private Link 3. In Salesforce, imposta IP Relaxation: \"Relax IP restrictions\" 4. Nessuna configurazione di range IP necessaria</p> <p>Opzione B: Configura Range IP Pubblici 1. Vai a Setup \u2192 Network Access 2. Clicca su New per aggiungere range IP 3. Aggiungi i range IP di Azure Cloud per la tua regione    - Vedi Gestione Network e Sicurezza per dettagli 4. Nota: I range IP cambiano settimanalmente, richiede manutenzione periodica</p>"},{"location":"implementation/ccf/#15-configurare-permessi","title":"1.5 Configurare Permessi","text":"<ol> <li>Vai a Setup \u2192 Users \u2192 Permission Sets</li> <li>Crea un nuovo Permission Set chiamato \"Azure Sentinel Integration\"</li> <li>Aggiungi i permessi:</li> <li>API Enabled</li> <li>View Event Log Files</li> <li>Assegna il Permission Set all'utente che eseguir\u00e0 l'integrazione</li> </ol>"},{"location":"implementation/ccf/#passo-2-preparazione-azure-sentinel","title":"Passo 2: Preparazione Azure Sentinel","text":""},{"location":"implementation/ccf/#21-verificare-log-analytics-workspace","title":"2.1 Verificare Log Analytics Workspace","text":"<ol> <li>Accedi al Portale Azure</li> <li>Cerca \"Log Analytics workspaces\"</li> <li>Verifica che esista un workspace (o creane uno nuovo)</li> <li>Annota il Workspace ID (lo trovi in Overview \u2192 Workspace ID)</li> </ol>"},{"location":"implementation/ccf/#22-abilitare-azure-sentinel","title":"2.2 Abilitare Azure Sentinel","text":"<ol> <li>Nel portale Azure, cerca \"Azure Sentinel\"</li> <li>Se non gi\u00e0 abilitato, clicca su Create</li> <li>Seleziona il Log Analytics Workspace</li> <li>Clicca su Add</li> </ol>"},{"location":"implementation/ccf/#passo-3-configurare-il-connector-ccf","title":"Passo 3: Configurare il Connector CCF","text":""},{"location":"implementation/ccf/#31-accedere-al-connector","title":"3.1 Accedere al Connector","text":"<ol> <li>In Azure Sentinel, vai a Data connectors</li> <li>Cerca \"Salesforce\" nella barra di ricerca</li> <li>Seleziona il connector Salesforce (se disponibile) oppure usa un connector CCF generico</li> <li>Clicca su Open connector page</li> </ol>"},{"location":"implementation/ccf/#32-configurare-autenticazione-oauth","title":"3.2 Configurare Autenticazione OAuth","text":"<ol> <li>Nella pagina del connector, clicca su Configure OAuth</li> <li>Compila i campi:    <pre><code>Client ID: &lt;Consumer Key da Salesforce&gt;\nClient Secret: &lt;Consumer Secret da Salesforce&gt;\nAuthorization URL: https://login.salesforce.com/services/oauth2/authorize\nToken URL: https://login.salesforce.com/services/oauth2/token\nScope: api refresh_token offline_access id profile email\n</code></pre></li> <li>Clicca su Authorize o Test Connection</li> <li>Verrai reindirizzato a Salesforce per autorizzare l'app</li> <li>Accetta le autorizzazioni</li> <li>Verifica che la connessione sia riuscita</li> </ol>"},{"location":"implementation/ccf/#33-configurare-parametri-di-raccolta","title":"3.3 Configurare Parametri di Raccolta","text":"<ol> <li>Nella configurazione del connector, imposta:    <pre><code>Event Types: LoginEvent, LogoutEvent, ApiEvent\nStart Date: &lt;Data di inizio raccolta, es. 2024-01-01&gt;\nPolling Interval: 15 minutes\n</code></pre></li> <li>Configura i filtri (opzionale):    <pre><code>Include Events: All\nExclude Events: (lascia vuoto o specifica eventi da escludere)\n</code></pre></li> </ol>"},{"location":"implementation/ccf/#34-configurare-mapping-dati","title":"3.4 Configurare Mapping Dati","text":"<p>Il connector mapper\u00e0 automaticamente i campi Salesforce ai campi Log Analytics:</p> <pre><code>Salesforce Field          \u2192 Log Analytics Field\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nEventType                 \u2192 EventType_s\nLogDate                   \u2192 TimeGenerated\nUserId                    \u2192 UserId_s\nUsername                  \u2192 UserName_s\nSourceIp                  \u2192 SourceIP_s\nBrowser                   \u2192 Browser_s\nPlatform                  \u2192 Platform_s\nLoginType                 \u2192 LoginType_s\nStatus                    \u2192 Status_s\n</code></pre>"},{"location":"implementation/ccf/#35-abilitare-il-connector","title":"3.5 Abilitare il Connector","text":"<ol> <li>Verifica tutte le configurazioni</li> <li>Clicca su Enable o Activate</li> <li>Attendi la conferma che il connector \u00e8 attivo</li> <li>Il connector inizier\u00e0 a raccogliere dati entro 15-30 minuti</li> </ol>"},{"location":"implementation/ccf/#passo-4-verificare-lintegrazione","title":"Passo 4: Verificare l'Integrazione","text":""},{"location":"implementation/ccf/#41-verificare-ricezione-dati","title":"4.1 Verificare Ricezione Dati","text":"<ol> <li>In Azure Sentinel, vai a Logs</li> <li>Esegui la query:    <pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| take 10\n| project TimeGenerated, UserName_s, EventType_s, SourceIP_s\n</code></pre></li> <li>Verifica che i dati siano presenti</li> </ol>"},{"location":"implementation/ccf/#42-verificare-schema-dati","title":"4.2 Verificare Schema Dati","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(24h)\n| summarize count() by EventType_s\n| render columnchart\n</code></pre>"},{"location":"implementation/ccf/#43-verificare-eventi-recenti","title":"4.3 Verificare Eventi Recenti","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| where EventType_s == \"LoginEvent\"\n| project TimeGenerated, UserName_s, SourceIP_s, Browser_s, Platform_s\n| order by TimeGenerated desc\n</code></pre>"},{"location":"implementation/ccf/#passo-5-configurare-query-e-alert","title":"Passo 5: Configurare Query e Alert","text":""},{"location":"implementation/ccf/#51-query-per-login-falliti","title":"5.1 Query per Login Falliti","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where Status_s == \"Failed\" or Status_s contains \"Failure\"\n| project TimeGenerated, UserName_s, SourceIP_s, Status_s\n| order by TimeGenerated desc\n</code></pre>"},{"location":"implementation/ccf/#52-alert-per-troppi-login-falliti","title":"5.2 Alert per Troppi Login Falliti","text":"<ol> <li>Vai a Analytics \u2192 Rules</li> <li>Clicca su Create \u2192 Scheduled query rule</li> <li>Configura:    <pre><code>Name: Salesforce - Multiple Failed Logins\nQuery:\nSalesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where Status_s == \"Failed\"\n| where TimeGenerated &gt; ago(1h)\n| summarize FailedAttempts = count() by UserName_s\n| where FailedAttempts &gt; 5\n\nEntity mapping: UserName_s \u2192 Account\nAlert threshold: Greater than 0\n</code></pre></li> <li>Salva e abilita la regola</li> </ol>"},{"location":"implementation/ccf/#53-query-per-accessi-da-ip-non-usuali","title":"5.3 Query per Accessi da IP Non Usuali","text":"<pre><code>let KnownIPs = Salesforce_CL\n| where TimeGenerated between (ago(30d) .. ago(1h))\n| where EventType_s == \"LoginEvent\"\n| summarize KnownIPSet = make_set(SourceIP_s) by UserName_s;\nSalesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| where EventType_s == \"LoginEvent\"\n| join kind=inner (KnownIPs) on UserName_s\n| where SourceIP_s !in (KnownIPSet)\n| project TimeGenerated, UserName_s, SourceIP_s\n</code></pre>"},{"location":"implementation/ccf/#passo-6-monitoraggio-e-manutenzione","title":"Passo 6: Monitoraggio e Manutenzione","text":""},{"location":"implementation/ccf/#61-verificare-stato-connector","title":"6.1 Verificare Stato Connector","text":"<ol> <li>Vai a Data connectors</li> <li>Verifica lo stato del connector Salesforce</li> <li>Controlla eventuali errori o avvisi</li> <li>Verifica l'ultima sincronizzazione</li> </ol>"},{"location":"implementation/ccf/#62-monitorare-volume-dati","title":"6.2 Monitorare Volume Dati","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(24h)\n| summarize \n    TotalEvents = count(),\n    EventsByType = count() by EventType_s\n| render piechart\n</code></pre>"},{"location":"implementation/ccf/#63-verificare-latenza","title":"6.3 Verificare Latenza","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| extend Latency = datetime_diff('minute', TimeGenerated, _IngestionTime)\n| summarize \n    AvgLatency = avg(Latency),\n    MaxLatency = max(Latency),\n    MinLatency = min(Latency)\n</code></pre>"},{"location":"implementation/ccf/#troubleshooting","title":"Troubleshooting","text":""},{"location":"implementation/ccf/#problema-nessun-dato-ricevuto","title":"Problema: Nessun Dato Ricevuto","text":"<p>Possibili Cause: - Event Monitoring non attivo da almeno 24-48 ore - Credenziali OAuth non valide - Connector non abilitato correttamente - Permessi insufficienti in Salesforce</p> <p>Soluzione: 1. Verifica che Event Monitoring sia attivo da almeno 48 ore 2. Testa le credenziali OAuth manualmente 3. Verifica lo stato del connector 4. Controlla i log del connector per errori</p>"},{"location":"implementation/ccf/#problema-errori-di-autenticazione","title":"Problema: Errori di Autenticazione","text":"<p>Possibili Cause: - Consumer Secret errato o scaduto - Callback URL non corrispondente - OAuth Scopes insufficienti</p> <p>Soluzione: 1. Rigenera il Consumer Secret se necessario 2. Verifica il Callback URL nella Connected App 3. Aggiungi tutti gli OAuth Scopes necessari</p>"},{"location":"implementation/ccf/#problema-dati-incompleti","title":"Problema: Dati Incompleti","text":"<p>Possibili Cause: - Filtri troppo restrittivi - Eventi non ancora disponibili - Rate limits raggiunti</p> <p>Soluzione: 1. Rivedi i filtri nella configurazione 2. Verifica la data degli eventi richiesti 3. Controlla i rate limits di Salesforce</p>"},{"location":"implementation/ccf/#limitazioni-e-limiti-di-polling","title":"Limitazioni e Limiti di Polling","text":""},{"location":"implementation/ccf/#limiti-di-polling-del-ccf","title":"Limiti di Polling del CCF","text":"<p>Il CCF ha limitazioni specifiche sul polling che \u00e8 importante conoscere:</p>"},{"location":"implementation/ccf/#intervallo-di-polling","title":"Intervallo di Polling","text":"<ul> <li>Intervallo Minimo: 5 minuti</li> <li>Intervallo Massimo: 24 ore</li> <li>Intervallo Consigliato: 15-30 minuti</li> <li>Intervallo Default: 15 minuti</li> </ul> <p>\u26a0\ufe0f Nota: Intervalli troppo brevi (&lt; 5 minuti) non sono supportati e possono causare: - Rate limiting da parte di Salesforce - Aumento dei costi Azure - Carico eccessivo sul sistema</p>"},{"location":"implementation/ccf/#limiti-di-volume-dati","title":"Limiti di Volume Dati","text":"<ul> <li>Dimensione Massima per Richiesta: 10 MB</li> <li>Numero Massimo di Eventi per Poll: 10.000 eventi</li> <li>Timeout Richiesta: 5 minuti</li> </ul> <p>Se il volume di eventi supera questi limiti: - Il connector effettuer\u00e0 pi\u00f9 richieste in batch - Potrebbe essere necessario aumentare l'intervallo di polling - Considera di filtrare eventi non essenziali</p>"},{"location":"implementation/ccf/#limiti-di-rate-limiting","title":"Limiti di Rate Limiting","text":"<p>Il CCF rispetta i limiti API di Salesforce:</p> <ul> <li>API Requests per 24h: Dipende dalla licenza Salesforce</li> <li>Enterprise: ~15.000 richieste/24h</li> <li>Unlimited: ~100.000 richieste/24h</li> <li>Performance: ~50.000 richieste/24h</li> <li>Concurrent Requests: Massimo 25 simultanee</li> <li>Event Log Files: Disponibili dopo 24-48 ore dalla generazione</li> </ul>"},{"location":"implementation/ccf/#calcolo-intervallo-ottimale","title":"Calcolo Intervallo Ottimale","text":"<p>Per calcolare l'intervallo di polling ottimale:</p> <pre><code>Intervallo (minuti) = (Eventi Giornalieri / Eventi per Poll) \u00d7 1440 / Numero Richieste Disponibili\n</code></pre> <p>Esempio: - 50.000 eventi/giorno - 10.000 eventi per poll - 15.000 richieste disponibili/24h</p> <pre><code>Intervallo = (50.000 / 10.000) \u00d7 1440 / 15.000 = 0.48 minuti\n</code></pre> <p>In questo caso, usa l'intervallo minimo di 5 minuti e considera: - Filtrare eventi non essenziali - Aumentare l'intervallo a 15-30 minuti - Usare una soluzione alternativa (Azure Function) per maggiore controllo</p>"},{"location":"implementation/ccf/#limitazioni-temporali","title":"Limitazioni Temporali","text":"<ul> <li>Delay Eventi: Gli eventi sono disponibili in Salesforce dopo 24-48 ore</li> <li>Latenza Raccolta: Il CCF pu\u00f2 avere una latenza di 15-30 minuti dall'evento alla raccolta</li> <li>Latenza Totale: Fino a 48-72 ore per eventi molto recenti</li> </ul>"},{"location":"implementation/ccf/#limitazioni-di-connettivita","title":"Limitazioni di Connettivit\u00e0","text":"<ul> <li>Timeout Connessione: 5 minuti</li> <li>Retry Automatico: 3 tentativi con backoff esponenziale</li> <li>Intervallo Retry: 1 minuto, 5 minuti, 15 minuti</li> </ul>"},{"location":"implementation/ccf/#gestione-dei-limiti","title":"Gestione dei Limiti","text":""},{"location":"implementation/ccf/#monitoraggio-utilizzo-api","title":"Monitoraggio Utilizzo API","text":"<pre><code>// Verifica numero di richieste effettuate\nSalesforce_CL\n| where TimeGenerated &gt; ago(24h)\n| summarize \n    TotalEvents = count(),\n    Requests = dcount(bin(TimeGenerated, 1h))\n| extend AvgEventsPerRequest = TotalEvents / Requests\n</code></pre>"},{"location":"implementation/ccf/#alert-per-limiti-raggiunti","title":"Alert per Limiti Raggiunti","text":"<p>Configura alert per: - Volume eventi superiore alla capacit\u00e0 - Errori di rate limiting - Timeout frequenti - Latenza eccessiva</p>"},{"location":"implementation/ccf/#ottimizzazione-polling","title":"Ottimizzazione Polling","text":"<ol> <li>Aumenta Intervallo: Se non hai bisogno di dati in tempo reale</li> <li>Filtra Eventi: Raccogli solo eventi essenziali</li> <li>Usa Batch: Raggruppa richieste quando possibile</li> <li>Monitora Costi: Intervalli brevi aumentano i costi Azure</li> </ol>"},{"location":"implementation/ccf/#best-practices","title":"Best Practices","text":"<ol> <li>Monitoraggio Proattivo: Configura alert per errori del connector</li> <li>Retention Dati: Configura retention appropriata in Log Analytics</li> <li>Sicurezza: Usa Key Vault per memorizzare credenziali sensibili</li> <li>Documentazione: Mantieni traccia delle configurazioni</li> <li>Test: Testa sempre in ambiente di sviluppo prima della produzione</li> <li>Polling Ottimale: Usa intervalli di 15-30 minuti per bilanciare latenza e costi</li> <li>Monitoraggio Limiti: Monitora regolarmente l'utilizzo API per evitare rate limiting</li> </ol>"},{"location":"implementation/ccf/#configurazione-avanzata","title":"Configurazione Avanzata","text":""},{"location":"implementation/ccf/#filtri-personalizzati","title":"Filtri Personalizzati","text":"<p>Puoi configurare filtri avanzati per raccogliere solo eventi specifici:</p> <pre><code>Event Types: LoginEvent\nFilters:\n  - Status: Success\n  - SourceIP: !contains \"10.0.0.0/8\"\n  - LoginType: Web\n</code></pre>"},{"location":"implementation/ccf/#trasformazione-dati","title":"Trasformazione Dati","text":"<p>Il CCF supporta trasformazioni base dei dati: - Rinomina campi - Aggiungi campi calcolati - Filtra valori</p>"},{"location":"implementation/ccf/#integrazione-con-altri-connector","title":"Integrazione con Altri Connector","text":"<p>Combina i dati Salesforce con altri log: - Azure AD Sign-in Logs - Office 365 Activity Logs - Altri log di sicurezza</p>"},{"location":"implementation/ccf/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione CCF Microsoft</li> <li>Salesforce Event Monitoring</li> <li>Azure Sentinel Documentation</li> <li>Troubleshooting Guide</li> </ul>"},{"location":"implementation/ccf/#esempio-di-configurazione-completa","title":"Esempio di Configurazione Completa","text":""},{"location":"implementation/ccf/#file-di-configurazione-json","title":"File di Configurazione (JSON)","text":"<pre><code>{\n  \"connector\": {\n    \"name\": \"Salesforce-CCF\",\n    \"type\": \"codeless\",\n    \"enabled\": true\n  },\n  \"authentication\": {\n    \"type\": \"oauth2\",\n    \"clientId\": \"3MVG9...\",\n    \"clientSecret\": \"ABC123...\",\n    \"authorizationUrl\": \"https://login.salesforce.com/services/oauth2/authorize\",\n    \"tokenUrl\": \"https://login.salesforce.com/services/oauth2/token\",\n    \"scope\": \"api refresh_token offline_access\"\n  },\n  \"dataCollection\": {\n    \"eventTypes\": [\"LoginEvent\", \"LogoutEvent\", \"ApiEvent\"],\n    \"startDate\": \"2024-01-01T00:00:00Z\",\n    \"pollingInterval\": 15,\n    \"filters\": {\n      \"include\": [\"*\"],\n      \"exclude\": []\n    }\n  },\n  \"mapping\": {\n    \"tableName\": \"Salesforce_CL\",\n    \"fields\": {\n      \"EventType\": \"EventType_s\",\n      \"LogDate\": \"TimeGenerated\",\n      \"UserId\": \"UserId_s\",\n      \"Username\": \"UserName_s\",\n      \"SourceIp\": \"SourceIP_s\"\n    }\n  }\n}\n</code></pre> <p>Prossimi Passi: - Configurare Query KQL avanzate - Gestire Network e Sicurezza - Risolvere problemi comuni</p>"},{"location":"implementation/kql-queries/","title":"Query KQL per Azure Sentinel","text":"<p>Raccolta di query KQL (Kusto Query Language) per analizzare gli eventi Salesforce in Azure Sentinel.</p>"},{"location":"implementation/kql-queries/#query-base","title":"Query Base","text":""},{"location":"implementation/kql-queries/#visualizzare-tutti-gli-eventi-recenti","title":"Visualizzare Tutti gli Eventi Recenti","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(24h)\n| project TimeGenerated, UserName_s, EventType_s, SourceIP_s, Browser_s, Platform_s\n| order by TimeGenerated desc\n</code></pre>"},{"location":"implementation/kql-queries/#contare-eventi-per-tipo","title":"Contare Eventi per Tipo","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(7d)\n| summarize count() by EventType_s\n| render columnchart\n</code></pre>"},{"location":"implementation/kql-queries/#eventi-per-utente","title":"Eventi per Utente","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(7d)\n| summarize EventCount = count() by UserName_s\n| order by EventCount desc\n| take 20\n</code></pre>"},{"location":"implementation/kql-queries/#query-di-sicurezza","title":"Query di Sicurezza","text":""},{"location":"implementation/kql-queries/#login-falliti","title":"Login Falliti","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where Success_b == false\n| project TimeGenerated, UserName_s, SourceIP_s, FailureReason_s\n| order by TimeGenerated desc\n</code></pre>"},{"location":"implementation/kql-queries/#accessi-da-ip-sospetti","title":"Accessi da IP Sospetti","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where SourceIP_s !startswith \"10.\" and SourceIP_s !startswith \"192.168.\"\n| summarize count() by SourceIP_s, UserName_s\n| order by count_ desc\n</code></pre>"},{"location":"implementation/kql-queries/#accessi-multipli-da-ip-diversi","title":"Accessi Multipli da IP Diversi","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where TimeGenerated &gt; ago(1h)\n| summarize IPCount = dcount(SourceIP_s), IPs = make_set(SourceIP_s) by UserName_s\n| where IPCount &gt; 3\n| project UserName_s, IPCount, IPs\n</code></pre>"},{"location":"implementation/kql-queries/#accessi-fuori-orario","title":"Accessi Fuori Orario","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where TimeGenerated &gt; ago(7d)\n| extend Hour = datetime_part(\"hour\", TimeGenerated)\n| where Hour &lt; 6 or Hour &gt; 22\n| summarize count() by UserName_s, Hour\n| order by count_ desc\n</code></pre>"},{"location":"implementation/kql-queries/#accessi-da-browserdevice-non-usuali","title":"Accessi da Browser/Device Non Usuali","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where TimeGenerated &gt; ago(30d)\n| summarize \n    CommonBrowsers = make_set(Browser_s) by UserName_s\n| extend BrowserCount = array_length(CommonBrowsers)\n| where BrowserCount &gt; 3\n| project UserName_s, BrowserCount, CommonBrowsers\n</code></pre>"},{"location":"implementation/kql-queries/#query-di-analisi","title":"Query di Analisi","text":""},{"location":"implementation/kql-queries/#attivita-per-ora-del-giorno","title":"Attivit\u00e0 per Ora del Giorno","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(7d)\n| extend Hour = datetime_part(\"hour\", TimeGenerated)\n| summarize EventCount = count() by Hour\n| order by Hour asc\n| render timechart\n</code></pre>"},{"location":"implementation/kql-queries/#top-10-utenti-per-attivita","title":"Top 10 Utenti per Attivit\u00e0","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(7d)\n| summarize \n    LoginCount = countif(EventType_s == \"LoginEvent\"),\n    ApiCallCount = countif(EventType_s == \"ApiEvent\"),\n    TotalEvents = count()\n    by UserName_s\n| order by TotalEvents desc\n| take 10\n</code></pre>"},{"location":"implementation/kql-queries/#distribuzione-geografica-se-disponibile","title":"Distribuzione Geografica (se disponibile)","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(7d)\n| where isnotempty(Country_s)\n| summarize count() by Country_s\n| order by count_ desc\n| render piechart\n</code></pre>"},{"location":"implementation/kql-queries/#pattern-di-accesso-giornaliero","title":"Pattern di Accesso Giornaliero","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(30d)\n| where EventType_s == \"LoginEvent\"\n| summarize DailyLogins = count() by bin(TimeGenerated, 1d), UserName_s\n| render timechart\n</code></pre>"},{"location":"implementation/kql-queries/#query-per-alerting","title":"Query per Alerting","text":""},{"location":"implementation/kql-queries/#alert-troppi-login-falliti","title":"Alert: Troppi Login Falliti","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where Success_b == false\n| where TimeGenerated &gt; ago(1h)\n| summarize FailedAttempts = count() by UserName_s\n| where FailedAttempts &gt; 5\n</code></pre>"},{"location":"implementation/kql-queries/#alert-nuovo-ip-per-utente","title":"Alert: Nuovo IP per Utente","text":"<pre><code>let KnownIPs = Salesforce_CL\n| where TimeGenerated between (ago(30d) .. ago(1h))\n| where EventType_s == \"LoginEvent\"\n| summarize KnownIPSet = make_set(SourceIP_s) by UserName_s;\nSalesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| where EventType_s == \"LoginEvent\"\n| join kind=inner (KnownIPs) on UserName_s\n| where SourceIP_s !in (KnownIPSet)\n| project TimeGenerated, UserName_s, SourceIP_s, KnownIPSet\n</code></pre>"},{"location":"implementation/kql-queries/#alert-accesso-da-paese-non-usuale","title":"Alert: Accesso da Paese Non Usuale","text":"<pre><code>let UsualCountries = Salesforce_CL\n| where TimeGenerated between (ago(30d) .. ago(1h))\n| where EventType_s == \"LoginEvent\"\n| summarize CountrySet = make_set(Country_s) by UserName_s;\nSalesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| where EventType_s == \"LoginEvent\"\n| where isnotempty(Country_s)\n| join kind=inner (UsualCountries) on UserName_s\n| where Country_s !in (CountrySet)\n| project TimeGenerated, UserName_s, Country_s, CountrySet\n</code></pre>"},{"location":"implementation/kql-queries/#query-di-correlazione","title":"Query di Correlazione","text":""},{"location":"implementation/kql-queries/#correlazione-con-altri-log-esempio-con-signinlogs","title":"Correlazione con Altri Log (esempio con SigninLogs)","text":"<pre><code>let SalesforceLogins = Salesforce_CL\n| where EventType_s == \"LoginEvent\"\n| where TimeGenerated &gt; ago(1h)\n| project TimeGenerated, UserName_s, SourceIP_s, EventType_s;\nSigninLogs\n| where TimeGenerated &gt; ago(1h)\n| project TimeGenerated, UserPrincipalName, IPAddress, AppDisplayName\n| join kind=inner (SalesforceLogins) \n    on $left.IPAddress == $right.SourceIP_s\n| project TimeGenerated, UserPrincipalName, IPAddress, UserName_s\n</code></pre>"},{"location":"implementation/kql-queries/#query-di-compliance-e-audit","title":"Query di Compliance e Audit","text":""},{"location":"implementation/kql-queries/#report-accessi-per-audit","title":"Report Accessi per Audit","text":"<pre><code>Salesforce_CL\n| where TimeGenerated between (startofday(ago(30d)) .. endofday(now()))\n| where EventType_s == \"LoginEvent\"\n| summarize \n    FirstLogin = min(TimeGenerated),\n    LastLogin = max(TimeGenerated),\n    LoginCount = count(),\n    UniqueIPs = dcount(SourceIP_s),\n    Platforms = make_set(Platform_s)\n    by UserName_s\n| order by LoginCount desc\n</code></pre>"},{"location":"implementation/kql-queries/#attivita-api-per-utente","title":"Attivit\u00e0 API per Utente","text":"<pre><code>Salesforce_CL\n| where EventType_s == \"ApiEvent\"\n| where TimeGenerated &gt; ago(7d)\n| summarize \n    ApiCallCount = count(),\n    UniqueEndpoints = dcount(Endpoint_s)\n    by UserName_s\n| order by ApiCallCount desc\n</code></pre>"},{"location":"implementation/kql-queries/#note","title":"Note","text":"<ul> <li>Sostituisci <code>Salesforce_CL</code> con il nome della tua tabella custom se diverso</li> <li>I nomi dei campi (es. <code>UserName_s</code>, <code>EventType_s</code>) potrebbero variare in base alla tua implementazione</li> <li>Aggiusta i filtri temporali (<code>ago(7d)</code>) in base alle tue esigenze</li> <li>Testa le query prima di usarle per alerting in produzione</li> </ul>"},{"location":"implementation/kql-queries/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione KQL</li> <li>KQL Quick Reference</li> <li>Azure Sentinel Query Examples</li> </ul>"},{"location":"implementation/network-sicurezza/","title":"Gestione Network e Sicurezza","text":"<p>Guida per gestire la connettivit\u00e0 di rete e la sicurezza quando si configura l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"implementation/network-sicurezza/#panoramica","title":"Panoramica","text":"<p>Quando si configura Salesforce per integrare con Azure, \u00e8 necessario gestire la connettivit\u00e0 di rete. Esistono due approcci principali:</p> <ol> <li>Azure Private Endpoints (\u2b50 Consigliato) - Soluzione pi\u00f9 sicura e gestita</li> <li>Range IP Pubblici Azure - Soluzione tradizionale che richiede manutenzione</li> </ol>"},{"location":"implementation/network-sicurezza/#approccio-consigliato-azure-private-endpoints","title":"\u2b50 Approccio Consigliato: Azure Private Endpoints","text":""},{"location":"implementation/network-sicurezza/#perche-usare-private-endpoints","title":"Perch\u00e9 Usare Private Endpoints","text":"<p>Azure Private Endpoints \u00e8 l'approccio consigliato per le seguenti ragioni:</p> <ul> <li>\u2705 Sicurezza Superiore: Comunicazione privata sulla rete Azure, non esposta a Internet</li> <li>\u2705 Zero Manutenzione: Non richiede aggiornamenti periodici dei range IP</li> <li>\u2705 Compliance: Soddisfa requisiti di sicurezza pi\u00f9 stringenti</li> <li>\u2705 Performance: Latenza ridotta e throughput ottimizzato</li> <li>\u2705 Isolamento: Traffico isolato dalla rete pubblica</li> <li>\u2705 Audit: Tracciamento completo del traffico di rete</li> </ul>"},{"location":"implementation/network-sicurezza/#come-funzionano-i-private-endpoints","title":"Come Funzionano i Private Endpoints","text":"<p>I Private Endpoints creano una connessione privata tra: - La tua risorsa Azure (Function App, Logic App, etc.) - Salesforce (tramite Azure Private Link)</p> <p>Il traffico rimane completamente all'interno della rete Azure e non passa attraverso Internet pubblico.</p>"},{"location":"implementation/network-sicurezza/#quando-usare-private-endpoints","title":"Quando Usare Private Endpoints","text":"<p>Usa Private Endpoints se: - Hai requisiti di sicurezza elevati - Vuoi evitare manutenzione periodica - Hai bisogno di compliance rigorosa - Il traffico deve rimanere privato - Hai budget per la configurazione iniziale</p> <p>Considera Range IP Pubblici se: - Non hai requisiti di sicurezza stringenti - Hai bisogno di una soluzione rapida e semplice - Non hai accesso a configurare Private Endpoints - Il costo \u00e8 un fattore critico</p>"},{"location":"implementation/network-sicurezza/#configurazione-private-endpoints-per-soluzione","title":"Configurazione Private Endpoints per Soluzione","text":""},{"location":"implementation/network-sicurezza/#per-azure-function","title":"Per Azure Function","text":"<ol> <li> <p>Crea Virtual Network:    <pre><code>Azure Portal \u2192 Virtual Networks \u2192 Create\n- Name: vnet-salesforce-integration\n- Address Space: 10.0.0.0/16\n- Subnet: subnet-functions (10.0.1.0/24)\n</code></pre></p> </li> <li> <p>Configura Function App con VNet Integration:</p> </li> <li>Function App \u2192 Networking \u2192 VNet integration</li> <li>Seleziona la VNet e subnet create</li> <li> <p>Abilita \"Route All\" se necessario</p> </li> <li> <p>Crea Private Endpoint:</p> </li> <li>Function App \u2192 Networking \u2192 Private endpoints</li> <li>Crea nuovo Private Endpoint</li> <li>Connetti alla VNet</li> <li> <p>Configura DNS privato</p> </li> <li> <p>Configura Salesforce:</p> </li> <li>In Salesforce, configura la Connected App per accettare connessioni dal Private Endpoint</li> <li>Usa l'IP privato del Private Endpoint invece di range IP pubblici</li> </ol>"},{"location":"implementation/network-sicurezza/#per-azure-logic-app","title":"Per Azure Logic App","text":"<ol> <li> <p>Crea Integration Service Environment (ISE):    <pre><code>Azure Portal \u2192 Logic Apps \u2192 Integration Service Environments \u2192 Create\n- Name: ise-salesforce-integration\n- Location: Seleziona regione\n- Network: Crea nuova VNet o usa esistente\n</code></pre></p> </li> <li> <p>Crea Logic App Standard con ISE:</p> </li> <li>Quando crei la Logic App, seleziona l'ISE come ambiente</li> <li> <p>La Logic App avr\u00e0 automaticamente connettivit\u00e0 privata</p> </li> <li> <p>Configura Connettori:</p> </li> <li>I connettori nell'ISE hanno automaticamente IP privati</li> <li>Configura Salesforce per accettare connessioni dall'ISE</li> </ol>"},{"location":"implementation/network-sicurezza/#per-ccf-codeless-connector-framework","title":"Per CCF (CodeLess Connector Framework)","text":"<p>\u26a0\ufe0f Nota: Il CCF \u00e8 un servizio gestito da Microsoft. La configurazione di Private Endpoints dipende dall'infrastruttura Azure Sentinel.</p> <ol> <li>Verifica Supporto Private Endpoints:</li> <li>Controlla la documentazione Microsoft per il supporto Private Endpoints nel CCF</li> <li> <p>Alcuni connector potrebbero non supportare Private Endpoints direttamente</p> </li> <li> <p>Alternativa - Azure Private Link per Log Analytics:</p> </li> <li>Configura Private Link per Log Analytics Workspace</li> <li>Il CCF invier\u00e0 dati tramite Private Link invece di Internet pubblico</li> </ol>"},{"location":"implementation/network-sicurezza/#costi-private-endpoints","title":"Costi Private Endpoints","text":"<ul> <li>Private Endpoint: ~$0.01/ora (~$7.30/mese)</li> <li>Private DNS Zone: ~$0.50/mese</li> <li>Data Processing: Costi standard per il traffico</li> </ul> <p>Totale stimato: ~$8-10/mese per Private Endpoint</p>"},{"location":"implementation/network-sicurezza/#dettagli-tecnici-private-endpoints","title":"Dettagli Tecnici Private Endpoints","text":""},{"location":"implementation/network-sicurezza/#architettura-private-endpoint","title":"Architettura Private Endpoint","text":"<pre><code>Salesforce API\n    \u2193\nInternet (HTTPS)\n    \u2193\nAzure Private Endpoint (IP Privato nella VNet)\n    \u2193\nAzure Function/Logic App (nella stessa VNet)\n    \u2193\nLog Analytics (tramite Private Link)\n</code></pre>"},{"location":"implementation/network-sicurezza/#componenti-necessari","title":"Componenti Necessari","text":"<ol> <li>Virtual Network (VNet)</li> <li>Spazio indirizzi privato (es. 10.0.0.0/16)</li> <li>Subnet dedicata per le risorse</li> <li> <p>Network Security Groups (NSG) per controllo traffico</p> </li> <li> <p>Private Endpoint</p> </li> <li>IP privato nella VNet (es. 10.0.1.5)</li> <li>Connessione privata al servizio Azure</li> <li> <p>Non esposto a Internet pubblico</p> </li> <li> <p>Private DNS Zone</p> </li> <li>Risoluzione DNS privata</li> <li>Mapping nome servizio \u2192 IP privato</li> <li> <p>Integrazione automatica con VNet</p> </li> <li> <p>Network Security Group (NSG)</p> </li> <li>Regole di sicurezza per il traffico</li> <li>Filtraggio basato su IP, porta, protocollo</li> <li>Logging e audit</li> </ol>"},{"location":"implementation/network-sicurezza/#configurazione-dettagliata-private-endpoint","title":"Configurazione Dettagliata Private Endpoint","text":"<p>Passo 1: Creare VNet e Subnet</p> <pre><code># Azure CLI\naz network vnet create \\\n  --resource-group rg-salesforce-integration \\\n  --name vnet-salesforce-integration \\\n  --address-prefix 10.0.0.0/16 \\\n  --subnet-name subnet-functions \\\n  --subnet-prefix 10.0.1.0/24\n</code></pre> <p>Passo 2: Creare Private DNS Zone</p> <pre><code># Azure CLI\naz network private-dns zone create \\\n  --resource-group rg-salesforce-integration \\\n  --name privatelink.azurewebsites.net\n</code></pre> <p>Passo 3: Collegare DNS Zone alla VNet</p> <pre><code># Azure CLI\naz network private-dns link vnet create \\\n  --resource-group rg-salesforce-integration \\\n  --zone-name privatelink.azurewebsites.net \\\n  --name link-to-vnet \\\n  --virtual-network vnet-salesforce-integration \\\n  --registration-enabled false\n</code></pre> <p>Passo 4: Creare Private Endpoint</p> <pre><code># Azure CLI\naz network private-endpoint create \\\n  --resource-group rg-salesforce-integration \\\n  --name pe-function-app \\\n  --vnet-name vnet-salesforce-integration \\\n  --subnet subnet-functions \\\n  --private-connection-resource-id /subscriptions/{subscription-id}/resourceGroups/{rg}/providers/Microsoft.Web/sites/{function-app-name} \\\n  --group-id sites \\\n  --connection-name connection-to-function\n</code></pre>"},{"location":"implementation/network-sicurezza/#monitoraggio-private-endpoints","title":"Monitoraggio Private Endpoints","text":"<p>Query KQL per Monitorare Connettivit\u00e0:</p> <pre><code>// Verifica connessioni Private Endpoint\nAzureDiagnostics\n| where Category == \"PrivateEndpointConnection\"\n| summarize count() by bin(TimeGenerated, 1h), ConnectionState\n| render timechart\n</code></pre> <p>Metriche da Monitorare: - Stato connessione Private Endpoint - Latenza delle richieste - Volume traffico - Errori di connessione</p>"},{"location":"implementation/network-sicurezza/#troubleshooting-private-endpoints","title":"Troubleshooting Private Endpoints","text":"<p>Problema: Connessione Fallita 1. Verifica che il Private Endpoint sia in stato \"Approved\" 2. Controlla le regole NSG 3. Verifica la risoluzione DNS privata 4. Controlla i log di Azure Monitor</p> <p>Problema: DNS Non Risolve 1. Verifica che la Private DNS Zone sia collegata alla VNet 2. Controlla le impostazioni DNS della VNet 3. Verifica che il record DNS sia presente</p> <p>Problema: Timeout Connessioni 1. Verifica che il NSG permetta il traffico necessario 2. Controlla che la subnet abbia spazio IP sufficiente 3. Verifica la latenza di rete</p>"},{"location":"implementation/network-sicurezza/#best-practices-private-endpoints","title":"Best Practices Private Endpoints","text":"<ol> <li>DNS Privato: Usa sempre Azure Private DNS Zones per risoluzione automatica</li> <li>Network Security Groups: Configura NSG per limitare il traffico solo a quello necessario</li> <li>Monitoring: Monitora la connettivit\u00e0 con Azure Monitor e metriche</li> <li>Backup: Configura endpoint secondari per alta disponibilit\u00e0</li> <li>Documentazione: Mantieni traccia di tutte le configurazioni (VNet, subnet, NSG)</li> <li>Tagging: Usa tag Azure per organizzare le risorse di rete</li> <li>Naming Convention: Usa nomi chiari e consistenti (es. <code>pe-{service}-{env}</code>)</li> <li>Access Control: Limita l'accesso alle risorse di rete con RBAC</li> <li>Cost Optimization: Monitora i costi dei Private Endpoints</li> <li>Testing: Testa sempre la connettivit\u00e0 dopo la configurazione</li> </ol>"},{"location":"implementation/network-sicurezza/#approccio-alternativo-range-ip-pubblici-azure","title":"Approccio Alternativo: Range IP Pubblici Azure","text":""},{"location":"implementation/network-sicurezza/#quando-usare-range-ip-pubblici","title":"Quando Usare Range IP Pubblici","text":"<p>Usa range IP pubblici se: - Non puoi configurare Private Endpoints - Hai bisogno di una soluzione rapida - I requisiti di sicurezza permettono traffico pubblico - Il budget \u00e8 limitato</p>"},{"location":"implementation/network-sicurezza/#perche-gestire-i-range-ip","title":"Perch\u00e9 Gestire i Range IP","text":"<ul> <li>Sicurezza: Restringere l'accesso solo da IP Azure autorizzati</li> <li>Compliance: Soddisfare requisiti di sicurezza aziendali</li> <li>Controllo Accesso: Prevenire accessi non autorizzati</li> </ul>"},{"location":"implementation/network-sicurezza/#range-ip-azure","title":"Range IP Azure","text":"<p>Azure pubblica i range IP per: - Azure Functions - Azure Logic Apps - Azure Service Bus - Altri servizi Azure</p>"},{"location":"implementation/network-sicurezza/#ottenere-i-range-ip","title":"Ottenere i Range IP","text":"<ol> <li>Download JSON ufficiale:</li> <li>URL: <code>https://download.microsoft.com/download/7/1/D/71D86715-5596-4529-9B13-DA13F5F5FE99/ServiceTags_Public_20240115.json</code></li> <li> <p>Aggiornato settimanalmente</p> </li> <li> <p>Tramite Azure Portal:</p> </li> <li>Vai a Network \u2192 Service Tags</li> <li> <p>Cerca \"AzureCloud\" o servizi specifici</p> </li> <li> <p>Tramite API:    <pre><code>curl https://download.microsoft.com/download/7/1/D/71D86715-5596-4529-9B13-DA13F5F5FE99/ServiceTags_Public_20240115.json\n</code></pre></p> </li> </ol>"},{"location":"implementation/network-sicurezza/#configurazione-in-salesforce","title":"Configurazione in Salesforce","text":""},{"location":"implementation/network-sicurezza/#trusted-ip-ranges","title":"Trusted IP Ranges","text":"<ol> <li>Vai a Setup \u2192 Network Access</li> <li>Clicca su New per aggiungere range IP</li> <li>Aggiungi i range IP di Azure per la tua regione</li> <li>Salva le modifiche</li> </ol>"},{"location":"implementation/network-sicurezza/#esempio-range-ip-per-regioni-comuni","title":"Esempio Range IP per Regioni Comuni","text":"<p>West Europe: - 20.50.0.0/16 - 20.51.0.0/16 - (verifica sempre i range aggiornati)</p> <p>East US: - 20.42.0.0/16 - 20.43.0.0/16 - (verifica sempre i range aggiornati)</p> <p>Nota: I range IP cambiano regolarmente. Usa sempre i range pi\u00f9 recenti.</p>"},{"location":"implementation/network-sicurezza/#automatizzazione","title":"Automatizzazione","text":""},{"location":"implementation/network-sicurezza/#script-powershell-per-aggiornare-range-ip","title":"Script PowerShell per Aggiornare Range IP","text":"<pre><code># Scarica i Service Tags\n$serviceTags = Invoke-RestMethod -Uri \"https://download.microsoft.com/download/7/1/D/71D86715-5596-4529-9B13-DA13F5F5FE99/ServiceTags_Public_20240115.json\"\n\n# Filtra per regione (es. WestEurope)\n$westEuropeIPs = $serviceTags.values | \n    Where-Object { $_.name -like \"*WestEurope*\" } | \n    Select-Object -ExpandProperty properties | \n    Select-Object -ExpandProperty addressPrefixes\n\n# Output per configurazione Salesforce\n$westEuropeIPs | ForEach-Object { Write-Host $_ }\n</code></pre>"},{"location":"implementation/network-sicurezza/#script-python","title":"Script Python","text":"<pre><code>import requests\nimport json\n\n# Scarica Service Tags\nresponse = requests.get(\"https://download.microsoft.com/download/7/1/D/71D86715-5596-4529-9B13-DA13F5F5FE99/ServiceTags_Public_20240115.json\")\ndata = response.json()\n\n# Filtra per regione\nregion = \"WestEurope\"\nip_ranges = []\nfor value in data['values']:\n    if region in value['name']:\n        ip_ranges.extend(value['properties']['addressPrefixes'])\n\n# Output\nfor ip in ip_ranges:\n    print(ip)\n</code></pre>"},{"location":"implementation/network-sicurezza/#best-practices","title":"Best Practices","text":"<ol> <li>Aggiornamento Regolare: I range IP cambiano settimanalmente</li> <li>Monitoraggio: Configura alert per cambiamenti nei range IP</li> <li>Documentazione: Mantieni traccia dei range IP configurati</li> <li>Test: Verifica sempre che la configurazione funzioni dopo aggiornamenti</li> </ol>"},{"location":"implementation/network-sicurezza/#differenze-per-soluzione","title":"Differenze per Soluzione","text":""},{"location":"implementation/network-sicurezza/#ccf-codeless-connector-framework","title":"CCF (CodeLess Connector Framework)","text":"<p>Caratteristiche: - Connector gestito da Microsoft - IP dinamici dell'infrastruttura Azure Sentinel - Range IP molto ampi (tutta l'infrastruttura Azure)</p> <p>Configurazione: - Se usi range IP: Configura range IP di Azure Cloud per la regione - Se usi Private Endpoints: Configura Private Link per Log Analytics (se supportato)</p> <p>Raccomandazione:  - Per sicurezza: Usa Private Link per Log Analytics se disponibile - Alternativa: Configura range IP Azure Cloud per la regione specifica</p>"},{"location":"implementation/network-sicurezza/#azure-function","title":"Azure Function","text":"<p>Caratteristiche: - IP dinamici della Function App - Range IP specifici per regione Azure - Possibilit\u00e0 di IP statico con App Service Plan Premium</p> <p>Configurazione: - Se usi range IP: Configura range IP Azure Functions per la regione - Se usi Private Endpoints: \u2b50 Consigliato - Configura VNet Integration + Private Endpoint</p> <p>Raccomandazione:  - \u2b50 Usa Private Endpoints per massima sicurezza - Alternativa: Configura range IP Azure Functions per la regione</p>"},{"location":"implementation/network-sicurezza/#azure-logic-app","title":"Azure Logic App","text":"<p>Caratteristiche: - IP dinamici del servizio Logic Apps - Range IP specifici per regione - Con ISE: IP privati dedicati</p> <p>Configurazione: - Se usi range IP: Configura range IP Azure Logic Apps per la regione - Se usi Private Endpoints: \u2b50 Consigliato - Usa Integration Service Environment (ISE)</p> <p>Raccomandazione:  - \u2b50 Usa ISE per connettivit\u00e0 privata nativa - Alternativa: Configura range IP Azure Logic Apps per la regione</p>"},{"location":"implementation/network-sicurezza/#troubleshooting","title":"Troubleshooting","text":""},{"location":"implementation/network-sicurezza/#problema-connessioni-bloccate","title":"Problema: Connessioni Bloccate","text":"<ol> <li>Verifica che i range IP siano aggiornati</li> <li>Controlla i log di Salesforce per IP bloccati</li> <li>Verifica la regione Azure corretta</li> </ol>"},{"location":"implementation/network-sicurezza/#problema-range-ip-troppo-ampi","title":"Problema: Range IP Troppo Ampi","text":"<ul> <li>Usa range IP specifici per regione invece di tutti i range Azure</li> <li>Considera l'uso di Private Endpoints</li> </ul>"},{"location":"implementation/network-sicurezza/#link-utili","title":"Link Utili","text":"<ul> <li>Azure IP Ranges and Service Tags</li> <li>Service Tags Documentation</li> <li>Salesforce Network Access</li> </ul>"},{"location":"implementation/platform-events/","title":"Implementazione Platform Events (Event Bus) - Near Real-Time","text":"<p>Guida completa per implementare l'integrazione Salesforce-Azure Sentinel usando Platform Events (Event Bus) per ottenere monitoraggio near real-time.</p>"},{"location":"implementation/platform-events/#panoramica","title":"Panoramica","text":"<p>I Platform Events (Event Bus) di Salesforce permettono di ottenere eventi in tempo reale (&lt; 1 minuto di latenza) invece dei 24-48 ore degli Event Log Files. Questa soluzione \u00e8 ideale quando \u00e8 necessario monitoraggio near real-time.</p>"},{"location":"implementation/platform-events/#limitazioni-importanti","title":"\u26a0\ufe0f Limitazioni Importanti","text":"<p>Prima di procedere, \u00e8 fondamentale comprendere le limitazioni:</p>"},{"location":"implementation/platform-events/#copertura-eventi","title":"Copertura Eventi","text":"<p>Eventi Disponibili su Platform Events: - \u2705 LoginEvent: Accessi utente (se configurato) - \u2705 LogoutEvent: Disconnessioni (se configurato) - \u2705 ApiEvent: Chiamate API (se configurato) - \u2705 Eventi custom definiti dall'organizzazione</p> <p>Eventi NON Disponibili su Platform Events: - \u274c Audit Trail: Azioni amministrative (solo su Event Log Files) - \u274c Field History Tracking: Modifiche ai campi (solo su Event Log Files) - \u274c Alcuni eventi di sicurezza avanzati</p> <p>Implicazione: Se hai bisogno di tutti gli eventi, potrebbe essere necessario un approccio ibrido (Platform Events + Event Log Files).</p>"},{"location":"implementation/platform-events/#requisiti-tecnici","title":"Requisiti Tecnici","text":"<ul> <li>Sviluppo Custom: Richiede sviluppo di codice (Apex, Azure Function)</li> <li>Manutenzione: Gestione continua del codice e delle configurazioni</li> <li>Complessit\u00e0: Maggiore complessit\u00e0 rispetto a Event Log Files API</li> <li>Costi: Costi di sviluppo e manutenzione</li> </ul>"},{"location":"implementation/platform-events/#architettura","title":"Architettura","text":"<pre><code>Salesforce Platform Events (Event Bus)\n    \u2193\nApex Trigger / Process Builder\n    \u2193\nCometD Streaming API (WebSocket)\n    \u2193\nAzure Function (Event Hub Trigger o HTTP Trigger)\n    \u2193\nTrasformazione Dati\n    \u2193\nLog Analytics Data Collector API\n    \u2193\nAzure Sentinel\n</code></pre>"},{"location":"implementation/platform-events/#componenti-dellarchitettura","title":"Componenti dell'Architettura","text":""},{"location":"implementation/platform-events/#1-salesforce-platform-events","title":"1. Salesforce Platform Events","text":"<p>Cosa sono: Eventi pubblicati in tempo reale su un bus eventi interno di Salesforce.</p> <p>Caratteristiche: - Eventi disponibili in tempo reale (&lt; 1 secondo) - Accessibili tramite Streaming API (CometD) - Supporto per eventi standard e custom</p>"},{"location":"implementation/platform-events/#2-streaming-api-cometd","title":"2. Streaming API (CometD)","text":"<p>Protocollo: CometD (Bayeux Protocol) su WebSocket</p> <p>Funzionamento: - Connessione persistente WebSocket - Push di eventi in tempo reale - Sottoscrizione a canali specifici (channels)</p>"},{"location":"implementation/platform-events/#3-azure-function","title":"3. Azure Function","text":"<p>Trigger Options: - HTTP Trigger: Salesforce chiama Function via webhook - Event Hub Trigger: Eventi via Azure Event Hub - Timer Trigger: Polling CometD (meno efficiente)</p>"},{"location":"implementation/platform-events/#implementazione-approccio-1-webhook-da-salesforce","title":"Implementazione: Approccio 1 - Webhook da Salesforce","text":""},{"location":"implementation/platform-events/#architettura_1","title":"Architettura","text":"<pre><code>Salesforce Platform Event\n    \u2193\nApex Trigger\n    \u2193\nCallout HTTP \u2192 Azure Function (HTTP Trigger)\n    \u2193\nLog Analytics\n    \u2193\nAzure Sentinel\n</code></pre>"},{"location":"implementation/platform-events/#passo-1-configurare-platform-events-in-salesforce","title":"Passo 1: Configurare Platform Events in Salesforce","text":""},{"location":"implementation/platform-events/#11-abilitare-platform-events","title":"1.1 Abilitare Platform Events","text":"<ol> <li>Vai a Setup \u2192 Platform Events</li> <li>Verifica che Platform Events sia abilitato</li> <li>Se necessario, abilita \"Enable Platform Events\"</li> </ol>"},{"location":"implementation/platform-events/#12-creare-platform-event-custom-se-necessario","title":"1.2 Creare Platform Event Custom (se necessario)","text":"<ol> <li>Vai a Setup \u2192 Platform Events \u2192 New Platform Event</li> <li>Crea un Platform Event per gli eventi di sicurezza:    <pre><code>API Name: Security_Event__e\nLabel: Security Event\n</code></pre></li> <li>Aggiungi campi necessari:</li> <li><code>EventType__c</code> (Text)</li> <li><code>UserName__c</code> (Text)</li> <li><code>SourceIP__c</code> (Text)</li> <li><code>Timestamp__c</code> (DateTime)</li> <li><code>EventData__c</code> (Long Text Area) - JSON</li> </ol>"},{"location":"implementation/platform-events/#passo-2-creare-apex-trigger-per-pubblicare-eventi","title":"Passo 2: Creare Apex Trigger per Pubblicare Eventi","text":""},{"location":"implementation/platform-events/#21-trigger-per-loginevent","title":"2.1 Trigger per LoginEvent","text":"<pre><code>trigger LoginEventTrigger on EventBusSubscriber (after insert) {\n    List&lt;Security_Event__e&gt; events = new List&lt;Security_Event__e&gt;();\n\n    for (EventBusSubscriber ebs : Trigger.new) {\n        if (ebs.Type == 'LoginEvent') {\n            Security_Event__e event = new Security_Event__e();\n            event.EventType__c = 'LoginEvent';\n            event.UserName__c = ebs.UserId;\n            event.SourceIP__c = ebs.SourceIp;\n            event.Timestamp__c = DateTime.now();\n            event.EventData__c = JSON.serialize(ebs);\n            events.add(event);\n        }\n    }\n\n    if (!events.isEmpty()) {\n        List&lt;Database.SaveResult&gt; results = EventBus.publish(events);\n    }\n}\n</code></pre>"},{"location":"implementation/platform-events/#22-apex-class-per-callout-http","title":"2.2 Apex Class per Callout HTTP","text":"<pre><code>public class AzureSentinelIntegration {\n    private static final String FUNCTION_URL = 'https://your-function.azurewebsites.net/api/SalesforceEvent';\n\n    @future(callout=true)\n    public static void sendToAzureSentinel(String eventData) {\n        HttpRequest req = new HttpRequest();\n        req.setEndpoint(FUNCTION_URL);\n        req.setMethod('POST');\n        req.setHeader('Content-Type', 'application/json');\n        req.setBody(eventData);\n        req.setTimeout(12000);\n\n        Http http = new Http();\n        HttpResponse res = http.send(req);\n\n        if (res.getStatusCode() != 200) {\n            // Log error\n            System.debug('Error: ' + res.getStatusCode() + ' - ' + res.getBody());\n        }\n    }\n}\n</code></pre>"},{"location":"implementation/platform-events/#23-trigger-per-invio-a-azure-function","title":"2.3 Trigger per Invio a Azure Function","text":"<pre><code>trigger SecurityEventTrigger on Security_Event__e (after insert) {\n    for (Security_Event__e event : Trigger.new) {\n        String eventJson = JSON.serialize(event);\n        AzureSentinelIntegration.sendToAzureSentinel(eventJson);\n    }\n}\n</code></pre>"},{"location":"implementation/platform-events/#passo-3-configurare-azure-function-http-trigger","title":"Passo 3: Configurare Azure Function (HTTP Trigger)","text":""},{"location":"implementation/platform-events/#31-creare-function-app","title":"3.1 Creare Function App","text":"<ol> <li>Crea Azure Function App (vedi Implementazione Azure Function)</li> <li>Crea una Function con HTTP Trigger</li> </ol>"},{"location":"implementation/platform-events/#32-implementare-function","title":"3.2 Implementare Function","text":"<pre><code>[FunctionName(\"SalesforceEvent\")]\npublic static async Task&lt;IActionResult&gt; Run(\n    [HttpTrigger(AuthorizationLevel.Function, \"post\", Route = null)] HttpRequest req,\n    ILogger log)\n{\n    try {\n        string requestBody = await new StreamReader(req.Body).ReadToEndAsync();\n        var salesforceEvent = JsonConvert.DeserializeObject&lt;SalesforceEvent&gt;(requestBody);\n\n        // Trasforma evento\n        var logEntry = new {\n            TimeGenerated = DateTime.UtcNow,\n            EventType = salesforceEvent.EventType__c,\n            UserName = salesforceEvent.UserName__c,\n            SourceIP = salesforceEvent.SourceIP__c,\n            Timestamp = salesforceEvent.Timestamp__c,\n            EventData = salesforceEvent.EventData__c\n        };\n\n        // Invia a Log Analytics\n        await SendToLogAnalytics(new[] { logEntry });\n\n        return new OkResult();\n    }\n    catch (Exception ex) {\n        log.LogError(ex, \"Error processing Salesforce event\");\n        return new StatusCodeResult(500);\n    }\n}\n</code></pre>"},{"location":"implementation/platform-events/#implementazione-approccio-2-cometd-streaming-api","title":"Implementazione: Approccio 2 - CometD Streaming API","text":""},{"location":"implementation/platform-events/#architettura_2","title":"Architettura","text":"<pre><code>Salesforce Platform Events\n    \u2193\nCometD Streaming API (WebSocket)\n    \u2193\nAzure Function (Long-running process)\n    \u2193\nLog Analytics\n    \u2193\nAzure Sentinel\n</code></pre>"},{"location":"implementation/platform-events/#passo-1-configurare-azure-function-per-cometd","title":"Passo 1: Configurare Azure Function per CometD","text":""},{"location":"implementation/platform-events/#11-function-con-timer-trigger-polling-cometd","title":"1.1 Function con Timer Trigger (Polling CometD)","text":"<pre><code>[FunctionName(\"SalesforceCometDListener\")]\npublic static async Task Run(\n    [TimerTrigger(\"0 */1 * * * *\")] TimerInfo myTimer,\n    ILogger log)\n{\n    // Connessione CometD\n    var cometDClient = new CometDClient();\n    await cometDClient.Connect(salesforceUrl, accessToken);\n\n    // Sottoscrivi a canale\n    await cometDClient.Subscribe(\"/event/Security_Event__e\", (message) =&gt; {\n        // Processa evento\n        ProcessEvent(message);\n    });\n\n    // Mantieni connessione attiva\n    await Task.Delay(TimeSpan.FromMinutes(5));\n    await cometDClient.Disconnect();\n}\n</code></pre>"},{"location":"implementation/platform-events/#12-libreria-cometd-per-net","title":"1.2 Libreria CometD per .NET","text":"<pre><code>dotnet add package CometD.NetCore\n</code></pre>"},{"location":"implementation/platform-events/#passo-2-autenticazione-salesforce-per-streaming-api","title":"Passo 2: Autenticazione Salesforce per Streaming API","text":"<pre><code>public class SalesforceAuth {\n    public async Task&lt;string&gt; GetAccessToken() {\n        var client = new HttpClient();\n        var content = new FormUrlEncodedContent(new[] {\n            new KeyValuePair&lt;string, string&gt;(\"grant_type\", \"password\"),\n            new KeyValuePair&lt;string, string&gt;(\"client_id\", consumerKey),\n            new KeyValuePair&lt;string, string&gt;(\"client_secret\", consumerSecret),\n            new KeyValuePair&lt;string, string&gt;(\"username\", username),\n            new KeyValuePair&lt;string, string&gt;(\"password\", password + securityToken)\n        });\n\n        var response = await client.PostAsync(\n            \"https://login.salesforce.com/services/oauth2/token\", \n            content);\n\n        var result = await response.Content.ReadAsStringAsync();\n        var token = JsonConvert.DeserializeObject&lt;OAuthToken&gt;(result);\n        return token.access_token;\n    }\n}\n</code></pre>"},{"location":"implementation/platform-events/#implementazione-approccio-3-azure-event-hub-consigliato","title":"Implementazione: Approccio 3 - Azure Event Hub (Consigliato)","text":""},{"location":"implementation/platform-events/#architettura_3","title":"Architettura","text":"<pre><code>Salesforce Platform Events\n    \u2193\nApex Trigger \u2192 HTTP Callout\n    \u2193\nAzure Event Hub\n    \u2193\nAzure Function (Event Hub Trigger)\n    \u2193\nLog Analytics\n    \u2193\nAzure Sentinel\n</code></pre>"},{"location":"implementation/platform-events/#vantaggi-event-hub","title":"Vantaggi Event Hub","text":"<ul> <li>Scalabilit\u00e0: Gestione automatica di picchi di eventi</li> <li>Affidabilit\u00e0: Persistenza eventi, retry automatico</li> <li>Performance: Throughput elevato</li> <li>Decoupling: Disaccoppiamento tra Salesforce e Function</li> </ul>"},{"location":"implementation/platform-events/#passo-1-creare-azure-event-hub","title":"Passo 1: Creare Azure Event Hub","text":"<ol> <li>Azure Portal \u2192 Event Hubs \u2192 Create</li> <li>Configura:</li> <li>Namespace: <code>salesforce-events-ns</code></li> <li>Event Hub: <code>salesforce-security-events</code></li> <li>Partition Count: 4-8 (per scalabilit\u00e0)</li> <li>Message Retention: 1-7 giorni</li> </ol>"},{"location":"implementation/platform-events/#passo-2-modificare-apex-per-event-hub","title":"Passo 2: Modificare Apex per Event Hub","text":"<pre><code>public class AzureEventHubIntegration {\n    private static final String EVENT_HUB_URL = 'https://salesforce-events-ns.servicebus.windows.net/salesforce-security-events/messages';\n    private static final String SAS_TOKEN = 'SharedAccessSignature ...';\n\n    @future(callout=true)\n    public static void sendToEventHub(String eventData) {\n        HttpRequest req = new HttpRequest();\n        req.setEndpoint(EVENT_HUB_URL + '?timeout=60&amp;api-version=2014-01');\n        req.setMethod('POST');\n        req.setHeader('Content-Type', 'application/atom+xml;type=entry;charset=utf-8');\n        req.setHeader('Authorization', SAS_TOKEN);\n        req.setBody(eventData);\n\n        Http http = new Http();\n        HttpResponse res = http.send(req);\n    }\n}\n</code></pre>"},{"location":"implementation/platform-events/#passo-3-azure-function-con-event-hub-trigger","title":"Passo 3: Azure Function con Event Hub Trigger","text":"<pre><code>[FunctionName(\"ProcessSalesforceEvents\")]\npublic static async Task Run(\n    [EventHubTrigger(\"salesforce-security-events\", Connection = \"EventHubConnection\")] \n    EventData[] events,\n    ILogger log)\n{\n    var logEntries = new List&lt;object&gt;();\n\n    foreach (EventData eventData in events) {\n        var salesforceEvent = JsonConvert.DeserializeObject&lt;SalesforceEvent&gt;(\n            Encoding.UTF8.GetString(eventData.Body.Array));\n\n        logEntries.Add(new {\n            TimeGenerated = DateTime.UtcNow,\n            EventType = salesforceEvent.EventType__c,\n            UserName = salesforceEvent.UserName__c,\n            SourceIP = salesforceEvent.SourceIP__c\n        });\n    }\n\n    // Invia batch a Log Analytics\n    await SendToLogAnalytics(logEntries);\n}\n</code></pre>"},{"location":"implementation/platform-events/#configurazione-network-e-sicurezza","title":"Configurazione Network e Sicurezza","text":""},{"location":"implementation/platform-events/#opzione-1-webhook-http-approccio-1","title":"Opzione 1: Webhook HTTP (Approccio 1)","text":"<p>Configurazione Salesforce: - Aggiungi IP/URL Azure Function in Remote Site Settings - Configura Callout Limits se necessario</p> <p>Configurazione Azure Function: - Usa Private Endpoints per sicurezza (vedi Network e Sicurezza) - Configura IP Restrictions se necessario - Usa HTTPS obbligatorio</p>"},{"location":"implementation/platform-events/#opzione-2-event-hub-approccio-3","title":"Opzione 2: Event Hub (Approccio 3)","text":"<p>Configurazione Event Hub: - Shared Access Policy con permessi Send - SAS Token per autenticazione da Salesforce - Private Endpoints per sicurezza (consigliato)</p>"},{"location":"implementation/platform-events/#limitazioni-e-considerazioni","title":"Limitazioni e Considerazioni","text":""},{"location":"implementation/platform-events/#limitazioni-platform-events","title":"Limitazioni Platform Events","text":"<ol> <li>Copertura Eventi:</li> <li>Non tutti gli eventi sono disponibili</li> <li>Audit Trail non disponibile</li> <li> <p>Alcuni eventi richiedono configurazione custom</p> </li> <li> <p>Rate Limits:</p> </li> <li>Platform Events pubblicati: 2.000.000/giorno (Enterprise)</li> <li>API Callouts: 100.000/giorno (Enterprise)</li> <li> <p>Concurrent Callouts: 10 simultanee</p> </li> <li> <p>Complessit\u00e0:</p> </li> <li>Richiede sviluppo Apex</li> <li>Gestione errori e retry</li> <li>Monitoraggio connessioni</li> </ol>"},{"location":"implementation/platform-events/#considerazioni-operative","title":"Considerazioni Operative","text":"<ol> <li>Affidabilit\u00e0:</li> <li>Gestire timeout e retry</li> <li>Dead letter queue per eventi falliti</li> <li> <p>Monitoring e alerting</p> </li> <li> <p>Costi:</p> </li> <li>Costi Azure Function (esecuzioni)</li> <li>Costi Event Hub (se usato)</li> <li> <p>Costi Log Analytics (ingestione)</p> </li> <li> <p>Manutenzione:</p> </li> <li>Aggiornamenti codice Apex</li> <li>Gestione credenziali</li> <li>Monitoraggio performance</li> </ol>"},{"location":"implementation/platform-events/#confronto-platform-events-vs-event-log-files","title":"Confronto: Platform Events vs Event Log Files","text":"Aspetto Platform Events Event Log Files Latenza &lt; 1 minuto 24-48 ore Copertura Limitata Completa Setup Complesso (sviluppo) Semplice (CCF) Manutenzione Alta Zero (CCF) Costi Sviluppo + Azure Solo Azure Affidabilit\u00e0 Richiede gestione Gestita (CCF) Audit Trail \u274c Non disponibile \u2705 Disponibile"},{"location":"implementation/platform-events/#raccomandazione-approccio-ibrido","title":"Raccomandazione: Approccio Ibrido","text":"<p>Per massimizzare copertura e latenza, considera un approccio ibrido:</p> <ol> <li>Platform Events per eventi critici in tempo reale:</li> <li>LoginEvent</li> <li>LogoutEvent</li> <li> <p>Eventi custom critici</p> </li> <li> <p>Event Log Files API (CCF) per:</p> </li> <li>Audit Trail</li> <li>Eventi storici completi</li> <li>Backup e compliance</li> </ol>"},{"location":"implementation/platform-events/#architettura-ibrida","title":"Architettura Ibrida","text":"<pre><code>Salesforce\n    \u2193\n    \u251c\u2500\u2192 Platform Events \u2192 Event Hub \u2192 Function \u2192 Sentinel (Real-time)\n    \u2514\u2500\u2192 Event Log Files \u2192 CCF \u2192 Sentinel (24-48h, completo)\n</code></pre>"},{"location":"implementation/platform-events/#best-practices","title":"Best Practices","text":"<ol> <li>Filtraggio Eventi: Pubblica solo eventi critici su Platform Events</li> <li>Batch Processing: Raggruppa eventi prima di inviare a Log Analytics</li> <li>Error Handling: Implementa retry con exponential backoff</li> <li>Monitoring: Monitora connessioni, errori, latenza</li> <li>Testing: Testa in ambiente sandbox prima di produzione</li> <li>Documentation: Documenta trigger Apex e configurazioni</li> </ol>"},{"location":"implementation/platform-events/#troubleshooting","title":"Troubleshooting","text":""},{"location":"implementation/platform-events/#problema-eventi-non-ricevuti","title":"Problema: Eventi Non Ricevuti","text":"<p>Possibili Cause: - Trigger Apex non attivo - Callout limits raggiunti - Timeout connessione - Errori in Azure Function</p> <p>Soluzione: 1. Verifica trigger Apex in Setup \u2192 Apex Triggers 2. Controlla Debug Logs in Salesforce 3. Verifica log Azure Function 4. Controlla Remote Site Settings</p>"},{"location":"implementation/platform-events/#problema-latenza-elevata","title":"Problema: Latenza Elevata","text":"<p>Possibili Cause: - Callout timeout - Function cold start - Event Hub throttling</p> <p>Soluzione: 1. Aumenta timeout callout (max 120 secondi) 2. Usa Premium Plan per Function (no cold start) 3. Aumenta throughput Event Hub</p>"},{"location":"implementation/platform-events/#link-utili","title":"Link Utili","text":"<ul> <li>Salesforce Platform Events Documentation</li> <li>Streaming API Documentation</li> <li>Azure Event Hubs</li> <li>Azure Functions HTTP Trigger</li> <li>Implementazione Azure Function</li> <li>Network e Sicurezza</li> </ul> <p>Nota: Questo approccio richiede competenze di sviluppo Apex e Azure Function. Se non hai questi requisiti, considera l'approccio Event Log Files con CCF.</p>"},{"location":"introduction/architecture/","title":"Architettura","text":"<p>Panoramica dell'architettura dell'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"introduction/architecture/#architettura-generale","title":"Architettura Generale","text":"<p>L'integrazione segue un pattern di raccolta eventi da Salesforce e invio a Azure Sentinel per l'analisi e il monitoraggio della sicurezza.</p>"},{"location":"introduction/architecture/#componenti-principali","title":"Componenti Principali","text":""},{"location":"introduction/architecture/#salesforce","title":"Salesforce","text":"<ul> <li>Event Monitoring: Genera eventi di accesso (LoginEvent, LogoutEvent, ApiEvent)</li> <li>Connected App: Autenticazione OAuth per l'accesso alle API</li> <li>Event Log Files API: API per recuperare i log degli eventi</li> </ul>"},{"location":"introduction/architecture/#layer-di-integrazione","title":"Layer di Integrazione","text":"<p>Il layer di integrazione varia in base alla soluzione scelta:</p> <ul> <li>CCF: Connector nativo Azure Sentinel</li> <li>Azure Function: Funzione serverless per trasformazione e invio</li> <li>Logic App: Workflow orchestrato per la gestione degli eventi</li> <li>Syslog: Server Syslog per la raccolta centralizzata</li> </ul>"},{"location":"introduction/architecture/#azure-sentinel","title":"Azure Sentinel","text":"<ul> <li>Log Analytics Workspace: Storage dei log</li> <li>KQL Queries: Analisi e query sui dati</li> <li>Workbooks: Dashboard e visualizzazioni</li> <li>Alerting: Regole di allerta per eventi sospetti</li> </ul>"},{"location":"introduction/architecture/#flusso-dei-dati","title":"Flusso dei Dati","text":"<pre><code>Salesforce Event Monitoring\n    \u2193\nEvent Log Files API\n    \u2193\nLayer di Integrazione (CCF/Function/Logic App)\n    \u2193\nAzure Sentinel / Log Analytics\n    \u2193\nAnalisi e Monitoraggio\n</code></pre>"},{"location":"introduction/architecture/#pattern-di-integrazione","title":"Pattern di Integrazione","text":""},{"location":"introduction/architecture/#pattern-push-real-time-platform-events","title":"Pattern Push Real-Time (Platform Events)","text":"<p>Salesforce Platform Events \u2192 Streaming API/Webhook \u2192 Azure Function/Event Hub \u2192 Azure Sentinel</p> <p>Caratteristiche: - Latenza: &lt; 1 minuto (near real-time) - Copertura: Limitata (non tutti gli eventi disponibili) - Complessit\u00e0: Alta (richiede sviluppo)</p>"},{"location":"introduction/architecture/#pattern-push-ccf-function-logic-app","title":"Pattern Push (CCF, Function, Logic App)","text":"<p>Salesforce \u2192 API Call \u2192 Integrazione \u2192 Azure Sentinel</p> <p>Caratteristiche: - Latenza: 24-72 ore (limite strutturale Event Log Files) - Copertura: Completa - Complessit\u00e0: Bassa (CCF) o Media (Function)</p>"},{"location":"introduction/architecture/#pattern-pull-function-logic-app","title":"Pattern Pull (Function, Logic App)","text":"<p>Integrazione \u2192 Polling API Salesforce \u2192 Trasformazione \u2192 Azure Sentinel</p> <p>Caratteristiche: - Latenza: 24-72 ore + intervallo polling - Copertura: Completa - Complessit\u00e0: Media</p>"},{"location":"introduction/architecture/#pattern-syslog","title":"Pattern Syslog","text":"<p>Salesforce \u2192 Syslog Server \u2192 Azure Monitor Agent \u2192 Azure Sentinel</p> <p>Caratteristiche: - Latenza: Dipende da configurazione - Copertura: Dipende da configurazione Salesforce - Complessit\u00e0: Media</p>"},{"location":"introduction/architecture/#considerazioni-di-sicurezza","title":"Considerazioni di Sicurezza","text":"<ul> <li>Autenticazione OAuth: Sicurezza delle credenziali</li> <li>HTTPS: Comunicazione criptata</li> <li>Network Security: Restrizioni IP e firewall</li> <li>Secrets Management: Gestione sicura delle credenziali (Key Vault)</li> </ul>"},{"location":"introduction/architecture/#scalabilita","title":"Scalabilit\u00e0","text":"<ul> <li>Eventi Volume: Gestione di picchi di eventi</li> <li>Retry Logic: Gestione errori e retry</li> <li>Rate Limiting: Rispetto dei limiti API Salesforce</li> <li>Cost Optimization: Ottimizzazione dei costi Azure</li> </ul>"},{"location":"introduction/overview/","title":"Panoramica","text":""},{"location":"introduction/overview/#cose-questa-integrazione","title":"Cos'\u00e8 questa integrazione?","text":"<p>Questa integrazione permette di trasferire automaticamente i log di accesso generati da Salesforce verso Azure Sentinel, creando un'unica piattaforma centralizzata per il monitoraggio della sicurezza.</p>"},{"location":"introduction/overview/#perche-integrare-salesforce-con-azure-sentinel","title":"Perch\u00e9 integrare Salesforce con Azure Sentinel?","text":""},{"location":"introduction/overview/#vantaggi","title":"Vantaggi","text":"<ul> <li>Visibilit\u00e0 Centralizzata: Tutti i log di accesso in un'unico posto</li> <li>Analisi Avanzata: Query KQL per identificare pattern sospetti</li> <li>Alerting Automatico: Notifiche per accessi anomali</li> <li>Compliance: Tracciamento completo degli accessi per audit</li> <li>Correlazione Eventi: Integrare con altri log di sicurezza</li> </ul>"},{"location":"introduction/overview/#cosa-viene-monitorato","title":"Cosa viene monitorato?","text":""},{"location":"introduction/overview/#eventi-salesforce-supportati","title":"Eventi Salesforce Supportati","text":"<ul> <li>LoginEvent: Accessi utente a Salesforce</li> <li>LogoutEvent: Disconnessioni</li> <li>ApiEvent: Chiamate API (estendibile)</li> <li>Altri eventi configurabili</li> </ul>"},{"location":"introduction/overview/#dati-inclusi","title":"Dati Inclusi","text":"<ul> <li>Timestamp accesso</li> <li>Username e User ID</li> <li>Indirizzo IP</li> <li>Browser e piattaforma</li> <li>Tipo di login</li> <li>Geolocalizzazione (se disponibile)</li> </ul>"},{"location":"introduction/overview/#soluzioni-disponibili","title":"Soluzioni Disponibili","text":"<p>Il progetto offre 5 soluzioni diverse per soddisfare ogni esigenza:</p> <ol> <li>CodeLess Connector Framework (CCF) - Setup rapido, zero manutenzione</li> <li>Azure Function - Massima personalizzazione</li> <li>Azure Logic App - Low-code visuale</li> <li>Syslog + Azure Monitor Agent - Per infrastrutture esistenti</li> <li>Third-party SIEM Connector - Per soluzioni enterprise</li> </ol> <p>Vedi confronto completo \u2192</p>"},{"location":"introduction/overview/#prerequisiti","title":"Prerequisiti","text":""},{"location":"introduction/overview/#salesforce","title":"Salesforce","text":"<ul> <li>Licenza Enterprise, Unlimited o Performance Edition</li> <li>Event Monitoring abilitato</li> <li>Permessi per creare Connected App</li> </ul>"},{"location":"introduction/overview/#azure","title":"Azure","text":"<ul> <li>Sottoscrizione Azure attiva</li> <li>Azure Sentinel Workspace</li> <li>Permessi per creare risorse Azure</li> </ul>"},{"location":"introduction/overview/#prossimi-passi","title":"Prossimi Passi","text":"<ol> <li>Scegli una soluzione</li> <li>Configura Salesforce</li> <li>Configura Azure Sentinel</li> <li>Segui il Quick Start</li> </ol>"},{"location":"references/api/","title":"API Reference","text":"<p>Riferimento alle API utilizzate nell'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"references/api/#salesforce-apis","title":"Salesforce APIs","text":""},{"location":"references/api/#event-log-files-api","title":"Event Log Files API","text":"<p>Endpoint per recuperare i log degli eventi Salesforce.</p> <p>Base URL: <code>https://&lt;instance&gt;.salesforce.com/services/data/v&lt;version&gt;/sobjects/EventLogFile/</code></p>"},{"location":"references/api/#metodi-principali","title":"Metodi Principali","text":"<p>GET /EventLogFile</p> <p>Recupera la lista dei file di log disponibili.</p> <p>Parametri: - <code>q</code>: Query SOQL (es. <code>SELECT Id, EventType, LogDate FROM EventLogFile WHERE LogDate = TODAY</code>)</p> <p>Esempio: <pre><code>GET /services/data/v58.0/sobjects/EventLogFile/?q=SELECT+Id,EventType,LogDate+FROM+EventLogFile+WHERE+LogDate=TODAY\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre></p> <p>GET /EventLogFile/{Id}/LogFile</p> <p>Scarica il contenuto di un file di log specifico.</p> <p>Esempio: <pre><code>GET /services/data/v58.0/sobjects/EventLogFile/{Id}/LogFile\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre></p>"},{"location":"references/api/#oauth-20-authentication","title":"OAuth 2.0 Authentication","text":"<p>Token Endpoint: <code>https://&lt;instance&gt;.salesforce.com/services/oauth2/token</code></p> <p>Grant Type: Username-Password Flow</p> <p>Request: <pre><code>POST /services/oauth2/token\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=password\n&amp;client_id=&lt;consumer_key&gt;\n&amp;client_secret=&lt;consumer_secret&gt;\n&amp;username=&lt;username&gt;\n&amp;password=&lt;password&gt;&lt;security_token&gt;\n</code></pre></p> <p>Response: <pre><code>{\n  \"access_token\": \"00D...\",\n  \"instance_url\": \"https://yourinstance.salesforce.com\",\n  \"id\": \"https://login.salesforce.com/id/...\",\n  \"token_type\": \"Bearer\",\n  \"issued_at\": \"1234567890\",\n  \"signature\": \"...\"\n}\n</code></pre></p>"},{"location":"references/api/#azure-log-analytics-data-collector-api","title":"Azure Log Analytics Data Collector API","text":"<p>Endpoint per inviare dati a Log Analytics.</p> <p>Base URL: <code>https://&lt;workspace-id&gt;.ods.opinsights.azure.com/api/logs?api-version=2016-04-01</code></p>"},{"location":"references/api/#post-apilogs","title":"POST /api/logs","text":"<p>Invia dati a Log Analytics.</p> <p>Headers: - <code>Log-Type</code>: Nome della tabella custom (es. <code>Salesforce_CL</code>) - <code>x-ms-date</code>: Data/ora in formato RFC 1123 - <code>Authorization</code>: Signature HMAC-SHA256 - <code>Content-Type</code>: <code>application/json</code></p> <p>Request Body: <pre><code>[\n  {\n    \"TimeGenerated\": \"2024-01-15T10:30:00Z\",\n    \"EventType\": \"LoginEvent\",\n    \"UserName\": \"user@example.com\",\n    \"SourceIP\": \"192.168.1.1\"\n  }\n]\n</code></pre></p> <p>Esempio: <pre><code>POST /api/logs?api-version=2016-04-01\nLog-Type: Salesforce_CL\nx-ms-date: Mon, 15 Jan 2024 10:30:00 GMT\nAuthorization: SharedKey &lt;workspace-id&gt;:&lt;signature&gt;\nContent-Type: application/json\n\n[{\"TimeGenerated\":\"2024-01-15T10:30:00Z\",\"EventType\":\"LoginEvent\",\"UserName\":\"user@example.com\",\"SourceIP\":\"192.168.1.1\"}]\n</code></pre></p>"},{"location":"references/api/#generazione-signature","title":"Generazione Signature","text":"<pre><code>string signature = BuildSignature(\n    jsonContent,\n    workspaceKey,\n    \"POST\",\n    contentLength,\n    \"application/json\",\n    date,\n    \"/api/logs\"\n);\n\nstring BuildSignature(string content, string key, string method, int contentLength, string contentType, string date, string resource)\n{\n    string stringToSign = $\"{method}\\n{contentLength}\\n{contentType}\\nx-ms-date:{date}\\n{resource}\";\n    byte[] keyBytes = Convert.FromBase64String(key);\n    byte[] messageBytes = Encoding.UTF8.GetBytes(stringToSign);\n    using (var hmac = new HMACSHA256(keyBytes))\n    {\n        byte[] hash = hmac.ComputeHash(messageBytes);\n        return Convert.ToBase64String(hash);\n    }\n}\n</code></pre>"},{"location":"references/api/#azure-service-management-api","title":"Azure Service Management API","text":""},{"location":"references/api/#get-service-tags","title":"Get Service Tags","text":"<p>Recupera i range IP di Azure.</p> <p>Endpoint: <code>https://management.azure.com/subscriptions/{subscriptionId}/providers/Microsoft.Network/locations/{location}/serviceTagDetails?api-version=2021-05-01</code></p> <p>Esempio: <pre><code>GET /subscriptions/{subscriptionId}/providers/Microsoft.Network/locations/westeurope/serviceTagDetails?api-version=2021-05-01\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre></p>"},{"location":"references/api/#rate-limits","title":"Rate Limits","text":""},{"location":"references/api/#salesforce","title":"Salesforce","text":"<ul> <li>API Requests: 15,000 per 24 ore (varia per licenza)</li> <li>Concurrent Requests: 25 simultanee</li> <li>Event Log Files: Disponibili dopo 24-48 ore</li> </ul>"},{"location":"references/api/#azure-log-analytics","title":"Azure Log Analytics","text":"<ul> <li>Data Ingestion: Fino a 6 GB/minuto per workspace</li> <li>API Calls: 500 richieste/minuto</li> <li>Payload Size: Max 30 MB per richiesta</li> </ul>"},{"location":"references/api/#error-handling","title":"Error Handling","text":""},{"location":"references/api/#salesforce-api-errors","title":"Salesforce API Errors","text":"<p>401 Unauthorized: - Token scaduto o non valido - Soluzione: Rinnova il token OAuth</p> <p>403 Forbidden: - Permessi insufficienti - Soluzione: Verifica Permission Sets</p> <p>429 Too Many Requests: - Rate limit superato - Soluzione: Implementa retry con backoff esponenziale</p>"},{"location":"references/api/#azure-log-analytics-errors","title":"Azure Log Analytics Errors","text":"<p>400 Bad Request: - Formato dati non valido - Soluzione: Verifica schema JSON</p> <p>401 Unauthorized: - Signature non valida - Soluzione: Verifica workspace key e algoritmo HMAC</p>"},{"location":"references/api/#link-utili","title":"Link Utili","text":"<ul> <li>Salesforce REST API Documentation</li> <li>Event Log Files API</li> <li>Log Analytics Data Collector API</li> <li>Azure Service Tags API</li> </ul>"},{"location":"references/links/","title":"Link Utili","text":"<p>Raccolta di link utili per l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"references/links/#documentazione-ufficiale","title":"Documentazione Ufficiale","text":""},{"location":"references/links/#salesforce","title":"Salesforce","text":"<ul> <li>Salesforce Event Monitoring</li> <li>Event Log Files API</li> <li>Connected Apps</li> <li>OAuth 2.0 Authentication</li> </ul>"},{"location":"references/links/#azure","title":"Azure","text":"<ul> <li>Azure Sentinel Documentation</li> <li>Log Analytics Workspace</li> <li>Azure Functions</li> <li>Azure Logic Apps</li> <li>Log Analytics Data Collector API</li> </ul>"},{"location":"references/links/#azure-sentinel-connectors","title":"Azure Sentinel Connectors","text":"<ul> <li>CodeLess Connector Framework</li> <li>Data Connectors Overview</li> <li>Custom Connectors</li> </ul>"},{"location":"references/links/#query-e-analisi","title":"Query e Analisi","text":"<ul> <li>KQL Documentation</li> <li>KQL Quick Reference</li> <li>Azure Sentinel Hunting Queries</li> <li>KQL Playground</li> </ul>"},{"location":"references/links/#sicurezza-e-compliance","title":"Sicurezza e Compliance","text":"<ul> <li>Azure IP Ranges and Service Tags</li> <li>Azure Service Tags</li> <li>Azure Key Vault</li> <li>Salesforce Security Best Practices</li> </ul>"},{"location":"references/links/#community-e-supporto","title":"Community e Supporto","text":"<ul> <li>Azure Sentinel Community</li> <li>Salesforce Developer Community</li> <li>Stack Overflow - Azure Sentinel</li> <li>Stack Overflow - Salesforce</li> </ul>"},{"location":"references/links/#strumenti-e-risorse","title":"Strumenti e Risorse","text":"<ul> <li>Postman Collection per Salesforce API</li> <li>Azure Portal</li> <li>Salesforce Setup</li> <li>Azure Pricing Calculator</li> </ul>"},{"location":"references/links/#github-e-repository","title":"GitHub e Repository","text":"<ul> <li>Azure Sentinel GitHub</li> <li>Salesforce GitHub</li> <li>Azure Functions Samples</li> </ul>"},{"location":"references/links/#blog-e-articoli","title":"Blog e Articoli","text":"<ul> <li>Azure Sentinel Blog</li> <li>Salesforce Developer Blog</li> <li>Microsoft Security Blog</li> </ul>"},{"location":"references/links/#training-e-learning","title":"Training e Learning","text":"<ul> <li>Microsoft Learn - Azure Sentinel</li> <li>Trailhead - Salesforce Security</li> <li>Azure Sentinel Learning Path</li> </ul>"},{"location":"references/links/#pricing-e-costi","title":"Pricing e Costi","text":"<ul> <li>Azure Sentinel Pricing</li> <li>Log Analytics Pricing</li> <li>Azure Functions Pricing</li> <li>Salesforce Event Monitoring Pricing</li> </ul>"},{"location":"references/links/#api-reference","title":"API Reference","text":"<ul> <li>Salesforce REST API</li> <li>Azure REST API Reference</li> <li>Log Analytics REST API</li> </ul>"},{"location":"setup/azure-sentinel/","title":"Configurazione Azure Sentinel","text":"<p>La configurazione di Azure Sentinel varia in base alla soluzione scelta.</p>"},{"location":"setup/azure-sentinel/#prerequisiti","title":"Prerequisiti","text":"<ul> <li>Sottoscrizione Azure attiva</li> <li>Permessi di Contributor o Owner sulla sottoscrizione</li> <li>Log Analytics Workspace esistente o da creare</li> <li>Azure Sentinel abilitato sul workspace</li> </ul>"},{"location":"setup/azure-sentinel/#passo-1-creare-log-analytics-workspace","title":"Passo 1: Creare Log Analytics Workspace","text":"<ol> <li>Accedi al Portale Azure</li> <li>Cerca \"Log Analytics workspaces\"</li> <li>Clicca su Create</li> <li>Compila i campi:</li> <li>Subscription: Seleziona la sottoscrizione</li> <li>Resource Group: Crea o seleziona un resource group</li> <li>Name: Nome del workspace (es. \"salesforce-sentinel-ws\")</li> <li>Region: Seleziona una regione</li> <li>Clicca su Review + Create \u2192 Create</li> </ol>"},{"location":"setup/azure-sentinel/#passo-2-abilitare-azure-sentinel","title":"Passo 2: Abilitare Azure Sentinel","text":"<ol> <li>Nel portale Azure, cerca \"Azure Sentinel\"</li> <li>Clicca su Create</li> <li>Seleziona il Log Analytics Workspace creato</li> <li>Clicca su Add</li> </ol>"},{"location":"setup/azure-sentinel/#passo-3-configurazione-per-soluzione","title":"Passo 3: Configurazione per Soluzione","text":""},{"location":"setup/azure-sentinel/#per-ccf-codeless-connector-framework","title":"Per CCF (CodeLess Connector Framework)","text":"<ol> <li>In Azure Sentinel, vai a Data connectors</li> <li>Cerca \"Salesforce\" o il connector specifico</li> <li>Segui la procedura guidata del connector</li> <li>Configura le credenziali Salesforce ottenute dalla configurazione</li> <li>Abilita il connector</li> </ol>"},{"location":"setup/azure-sentinel/#per-azure-function","title":"Per Azure Function","text":"<ol> <li>Crea un'Azure Function App (vedi Implementazione Azure Function)</li> <li>Configura Application Settings con:</li> <li>Credenziali Salesforce</li> <li>Workspace ID e Key di Log Analytics</li> <li>Configura la Function per inviare dati a Log Analytics</li> </ol>"},{"location":"setup/azure-sentinel/#per-logic-app","title":"Per Logic App","text":"<ol> <li>Crea un'Azure Logic App</li> <li>Configura i connettori Salesforce e Azure Monitor</li> <li>Imposta il workflow per l'integrazione</li> <li>Configura le credenziali necessarie</li> </ol>"},{"location":"setup/azure-sentinel/#passo-4-verificare-ricezione-dati","title":"Passo 4: Verificare Ricezione Dati","text":"<ol> <li>In Azure Sentinel, vai a Logs</li> <li>Esegui una query per verificare i dati:    <pre><code>Salesforce_CL\n| take 10\n</code></pre></li> <li>Se non vedi dati, verifica:</li> <li>Configurazione del connector/function/logic app</li> <li>Credenziali e permessi</li> <li>Rete e firewall</li> </ol>"},{"location":"setup/azure-sentinel/#passo-5-configurare-tabelle-custom-se-necessario","title":"Passo 5: Configurare Tabelle Custom (se necessario)","text":"<p>Se usi Azure Function o Logic App, potresti dover creare tabelle custom:</p> <ol> <li>Vai a Log Analytics workspace \u2192 Tables</li> <li>Crea una tabella custom se necessario</li> <li>Configura lo schema dei dati</li> </ol>"},{"location":"setup/azure-sentinel/#configurazioni-avanzate","title":"Configurazioni Avanzate","text":""},{"location":"setup/azure-sentinel/#data-retention","title":"Data Retention","text":"<ol> <li>Vai a Log Analytics workspace \u2192 Usage and estimated costs</li> <li>Configura la retention dei dati (default 30 giorni, fino a 2 anni)</li> </ol>"},{"location":"setup/azure-sentinel/#network-security","title":"Network Security","text":"<ul> <li>Configura Private Endpoints se necessario</li> <li>Restringi l'accesso tramite Network Access Control</li> <li>Configura IP Restrictions se applicabile</li> </ul>"},{"location":"setup/azure-sentinel/#cost-management","title":"Cost Management","text":"<ul> <li>Monitora l'ingestione dati in Usage and estimated costs</li> <li>Configura Data Collection Rules per ottimizzare i costi</li> <li>Considera Commitment Tiers per volumi elevati</li> </ul>"},{"location":"setup/azure-sentinel/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione Azure Sentinel</li> <li>Log Analytics Workspace</li> <li>Data Connectors</li> </ul>"},{"location":"setup/quick-start/","title":"Quick Start","text":"<p>Guida rapida per iniziare con l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"setup/quick-start/#panoramica","title":"Panoramica","text":"<p>Questa guida ti aiuter\u00e0 a configurare l'integrazione in pochi passaggi. Il tempo stimato \u00e8 di 30-60 minuti.</p>"},{"location":"setup/quick-start/#passo-1-scegliere-la-soluzione","title":"Passo 1: Scegliere la Soluzione","text":"<p>Scegli la soluzione pi\u00f9 adatta alle tue esigenze:</p> <ul> <li>CCF: Setup pi\u00f9 rapido, zero codice (consigliato per iniziare)</li> <li>Azure Function: Massima personalizzazione</li> <li>Logic App: Approccio low-code visuale</li> </ul> <p>Vedi Panoramica Soluzioni per il confronto completo.</p>"},{"location":"setup/quick-start/#passo-2-configurare-salesforce","title":"Passo 2: Configurare Salesforce","text":"<ol> <li>Abilita Event Monitoring in Salesforce</li> <li>Crea una Connected App</li> <li>Ottieni Consumer Key e Consumer Secret</li> <li>Verifica che Event Monitoring generi eventi</li> </ol> <p>Tempo stimato: 15-20 minuti</p> <p>Vedi Configurazione Salesforce per i dettagli completi.</p>"},{"location":"setup/quick-start/#passo-3-configurare-azure-sentinel","title":"Passo 3: Configurare Azure Sentinel","text":"<ol> <li>Crea un Log Analytics Workspace</li> <li>Abilita Azure Sentinel sul workspace</li> <li>Configura il connector o la soluzione scelta</li> <li>Verifica la ricezione dei dati</li> </ol> <p>Tempo stimato: 10-15 minuti</p> <p>Vedi Configurazione Azure Sentinel per i dettagli completi.</p>"},{"location":"setup/quick-start/#passo-4-verificare-lintegrazione","title":"Passo 4: Verificare l'Integrazione","text":""},{"location":"setup/quick-start/#verifica-dati-in-azure-sentinel","title":"Verifica Dati in Azure Sentinel","text":"<ol> <li>Apri Azure Sentinel \u2192 Logs</li> <li>Esegui la query:    <pre><code>Salesforce_CL\n| take 10\n| project TimeGenerated, UserName_s, EventType_s, SourceIP_s\n</code></pre></li> <li>Verifica che i dati siano presenti</li> </ol>"},{"location":"setup/quick-start/#verifica-eventi-recenti","title":"Verifica Eventi Recenti","text":"<pre><code>Salesforce_CL\n| where TimeGenerated &gt; ago(1h)\n| summarize count() by EventType_s\n| render columnchart\n</code></pre>"},{"location":"setup/quick-start/#passo-5-configurare-query-e-alert-opzionale","title":"Passo 5: Configurare Query e Alert (Opzionale)","text":"<ol> <li>Crea query KQL per analisi specifiche</li> <li>Configura regole di allerta per eventi sospetti</li> <li>Crea dashboard per il monitoraggio</li> </ol> <p>Vedi Query KQL per esempi.</p>"},{"location":"setup/quick-start/#checklist-completa","title":"Checklist Completa","text":"<ul> <li>[ ] Event Monitoring abilitato in Salesforce</li> <li>[ ] Connected App creata con OAuth</li> <li>[ ] Credenziali (Consumer Key/Secret) salvate</li> <li>[ ] Log Analytics Workspace creato</li> <li>[ ] Azure Sentinel abilitato</li> <li>[ ] Connector/Soluzione configurata</li> <li>[ ] Dati visibili in Log Analytics</li> <li>[ ] Query di verifica eseguite con successo</li> </ul>"},{"location":"setup/quick-start/#troubleshooting-rapido","title":"Troubleshooting Rapido","text":""},{"location":"setup/quick-start/#nessun-dato-visibile","title":"Nessun dato visibile","text":"<ol> <li>Verifica che Event Monitoring sia attivo da almeno 24-48 ore</li> <li>Controlla le credenziali OAuth</li> <li>Verifica i log della soluzione (Function/Logic App)</li> <li>Controlla i permessi e la configurazione di rete</li> </ol>"},{"location":"setup/quick-start/#errori-di-autenticazione","title":"Errori di autenticazione","text":"<ol> <li>Verifica Consumer Key e Secret</li> <li>Controlla Callback URL nella Connected App</li> <li>Verifica OAuth Scopes configurati</li> <li>Controlla che la Connected App sia attiva</li> </ol>"},{"location":"setup/quick-start/#dati-incompleti","title":"Dati incompleti","text":"<ol> <li>Verifica che Event Monitoring includa gli eventi necessari</li> <li>Controlla i filtri nella soluzione</li> <li>Verifica i limiti API di Salesforce</li> </ol>"},{"location":"setup/quick-start/#prossimi-passi","title":"Prossimi Passi","text":"<ul> <li>Configurare query KQL avanzate</li> <li>Gestire Network e Sicurezza</li> <li>Personalizzare l'implementazione</li> <li>Risolvere problemi comuni</li> </ul>"},{"location":"setup/quick-start/#supporto","title":"Supporto","text":"<p>Per problemi o domande: - Consulta la sezione Troubleshooting - Verifica i Link Utili - Controlla la Documentazione Microsoft</p>"},{"location":"setup/salesforce/","title":"Configurazione Salesforce","text":"<p>La configurazione Salesforce \u00e8 identica per tutte le soluzioni.</p>"},{"location":"setup/salesforce/#prerequisiti","title":"Prerequisiti","text":"<ul> <li>Licenza Salesforce Enterprise, Unlimited o Performance Edition</li> <li>Event Monitoring abilitato</li> <li>Permessi di amministratore per creare Connected App</li> <li>Accesso a Setup \u2192 Event Monitoring</li> </ul>"},{"location":"setup/salesforce/#passo-1-abilitare-event-monitoring","title":"Passo 1: Abilitare Event Monitoring","text":"<ol> <li>Accedi a Setup in Salesforce</li> <li>Cerca \"Event Monitoring\" nella barra di ricerca</li> <li>Vai a Event Monitoring Settings</li> <li>Abilita Event Monitoring se non gi\u00e0 attivo</li> <li>Verifica che Event Log Files sia abilitato</li> </ol>"},{"location":"setup/salesforce/#passo-2-creare-connected-app","title":"Passo 2: Creare Connected App","text":"<ol> <li>Vai a Setup \u2192 App Manager</li> <li>Clicca su New Connected App</li> <li>Compila i campi obbligatori:</li> <li>Connected App Name: Nome descrittivo (es. \"Azure Sentinel Integration\")</li> <li>API Name: Nome API (generato automaticamente)</li> <li>Contact Email: La tua email</li> <li>Abilita Enable OAuth Settings</li> <li>Configura Callback URL: </li> <li>Per CCF: URL fornito da Azure Sentinel</li> <li>Per Function/Logic App: URL della tua funzione/app</li> <li>Seleziona OAuth Scopes:</li> <li><code>Manage user data via APIs (api)</code></li> <li><code>Perform requests on your behalf at any time (refresh_token, offline_access)</code></li> <li><code>Access the identity URL service (id, profile, email, address, phone)</code></li> <li>Abilita Require Secret for Web Server Flow</li> <li>Salva e attendi alcuni minuti per la propagazione</li> </ol>"},{"location":"setup/salesforce/#passo-3-ottenere-credenziali","title":"Passo 3: Ottenere Credenziali","text":"<p>Dopo la creazione della Connected App:</p> <ol> <li>Vai alla Connected App appena creata</li> <li>Clicca su Manage \u2192 Edit Policies</li> <li>Configura le policy di sicurezza:</li> <li>Permitted Users: \"All users may self-authorize\" o \"Admin approved users are pre-authorized\"</li> <li>IP Relaxation: \"Relax IP restrictions\" (se necessario)</li> <li>Vai a API (Enable OAuth Settings) \u2192 View</li> <li>Copia:</li> <li>Consumer Key (Client ID)</li> <li>Consumer Secret (Client Secret)</li> </ol>"},{"location":"setup/salesforce/#passo-4-configurare-permessi-api","title":"Passo 4: Configurare Permessi API","text":"<ol> <li>Vai a Setup \u2192 Users \u2192 Permission Sets</li> <li>Crea o modifica un Permission Set</li> <li>Aggiungi i permessi necessari:</li> <li>API Enabled</li> <li>View Event Log Files</li> <li>Assegna il Permission Set agli utenti che eseguiranno l'integrazione</li> </ol>"},{"location":"setup/salesforce/#passo-5-verificare-event-monitoring","title":"Passo 5: Verificare Event Monitoring","text":"<ol> <li>Vai a Setup \u2192 Event Monitoring \u2192 Event Log Files</li> <li>Verifica che ci siano eventi recenti</li> <li>Controlla che gli eventi includano:</li> <li>LoginEvent</li> <li>LogoutEvent</li> <li>ApiEvent (se necessario)</li> </ol>"},{"location":"setup/salesforce/#note-importanti","title":"Note Importanti","text":"<ul> <li>Le credenziali OAuth sono sensibili: conservale in modo sicuro</li> <li>Il Consumer Secret viene mostrato solo una volta: salvalo immediatamente</li> <li>Event Monitoring pu\u00f2 avere un delay di 24-48 ore per l'attivazione</li> <li>Alcuni eventi potrebbero non essere disponibili immediatamente</li> </ul>"},{"location":"setup/salesforce/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Event Monitoring non disponibile: Verifica la licenza Salesforce</li> <li>Nessun evento visibile: Attendi 24-48 ore dopo l'abilitazione</li> <li>Errori OAuth: Verifica Callback URL e OAuth Scopes</li> <li>Permessi insufficienti: Verifica Permission Sets e profili utente</li> </ul>"},{"location":"solutions/azure-function/","title":"Azure Function","text":"<p>Soluzione basata su Azure Function per l'integrazione Salesforce-Azure Sentinel con massima personalizzazione.</p>"},{"location":"solutions/azure-function/#panoramica","title":"Panoramica","text":"<p>Azure Function \u00e8 la soluzione consigliata quando hai bisogno di controllo completo sul processo di integrazione e personalizzazione avanzata della logica di trasformazione dei dati.</p>"},{"location":"solutions/azure-function/#caratteristiche","title":"Caratteristiche","text":"<ul> <li>Massima Personalizzazione: Controllo completo sulla logica di trasformazione</li> <li>Scalabilit\u00e0: Gestione automatica del carico di lavoro</li> <li>Costi Ottimizzati: Paghi solo per l'esecuzione</li> <li>Monitoraggio Integrato: Log e metriche in Azure Monitor</li> </ul>"},{"location":"solutions/azure-function/#prerequisiti","title":"Prerequisiti","text":"<ul> <li>Azure Subscription</li> <li>Azure Function App</li> <li>Azure Sentinel Workspace</li> <li>Configurazione Salesforce completata</li> </ul>"},{"location":"solutions/azure-function/#implementazione","title":"Implementazione","text":"<p>Vedi la sezione Implementazione Azure Function per i dettagli tecnici.</p>"},{"location":"solutions/azure-function/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione Azure Functions</li> <li>Azure Function Pricing</li> </ul>"},{"location":"solutions/ccf/","title":"CodeLess Connector Framework (CCF)","text":"<p>Documentazione completa del CodeLess Connector Framework per l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"solutions/ccf/#panoramica","title":"Panoramica","text":"<p>Il CodeLess Connector Framework (CCF) \u00e8 la soluzione raccomandata per setup rapido senza codice.</p>"},{"location":"solutions/ccf/#configurazione","title":"Configurazione","text":"<p>Vedi la documentazione completa nel repository per i dettagli di configurazione.</p>"},{"location":"solutions/ccf/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione Microsoft</li> </ul>"},{"location":"solutions/logic-app/","title":"Azure Logic App","text":"<p>Soluzione low-code basata su Azure Logic App per l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"solutions/logic-app/#panoramica","title":"Panoramica","text":"<p>Azure Logic App offre un approccio visuale e low-code per integrare Salesforce con Azure Sentinel, ideale per team che preferiscono configurazione grafica rispetto alla scrittura di codice.</p>"},{"location":"solutions/logic-app/#caratteristiche","title":"Caratteristiche","text":"<ul> <li>Low-Code: Configurazione visuale tramite designer</li> <li>Template ARM: Deployment rapido con template predefiniti</li> <li>Connettori Integrati: Connettori nativi per Salesforce e Azure Sentinel</li> <li>Workflow Visuale: Design del flusso di lavoro tramite interfaccia grafica</li> </ul>"},{"location":"solutions/logic-app/#prerequisiti","title":"Prerequisiti","text":"<ul> <li>Azure Subscription</li> <li>Azure Logic App</li> <li>Azure Sentinel Workspace</li> <li>Configurazione Salesforce completata</li> <li>\u2b50 Raccomandato: Integration Service Environment (ISE) per connettivit\u00e0 privata</li> </ul>"},{"location":"solutions/logic-app/#network-e-sicurezza","title":"Network e Sicurezza","text":""},{"location":"solutions/logic-app/#approccio-consigliato-integration-service-environment-ise","title":"\u2b50 Approccio Consigliato: Integration Service Environment (ISE)","text":"<p>Per massima sicurezza e connettivit\u00e0 privata:</p> <ol> <li>Crea Integration Service Environment:</li> <li>Azure Portal \u2192 Logic Apps \u2192 Integration Service Environments \u2192 Create</li> <li>Name: <code>ise-salesforce-integration</code></li> <li>Location: Seleziona regione</li> <li> <p>Network: Crea nuova VNet o usa esistente</p> </li> <li> <p>Vantaggi ISE:</p> </li> <li>IP privati dedicati e statici</li> <li>Connettivit\u00e0 privata nativa</li> <li>Nessuna manutenzione di range IP</li> <li> <p>Maggiore sicurezza e compliance</p> </li> <li> <p>Configura Salesforce:</p> </li> <li>Usa gli IP privati dell'ISE</li> <li>In Salesforce, imposta IP Relaxation: \"Relax IP restrictions\" (non necessario con ISE)</li> </ol> <p>Alternativa - Range IP Pubblici: - Vedi Gestione Network e Sicurezza per configurare range IP pubblici - Richiede manutenzione periodica</p>"},{"location":"solutions/logic-app/#deployment","title":"Deployment","text":"<p>Il progetto include template ARM per il deployment rapido della Logic App.</p>"},{"location":"solutions/logic-app/#link-utili","title":"Link Utili","text":"<ul> <li>Documentazione Azure Logic Apps</li> <li>Logic Apps Connectors</li> </ul>"},{"location":"solutions/other/","title":"Altre Soluzioni","text":"<p>Panoramica delle soluzioni alternative per l'integrazione Salesforce-Azure Sentinel.</p>"},{"location":"solutions/other/#soluzioni-disponibili","title":"Soluzioni Disponibili","text":""},{"location":"solutions/other/#syslog-azure-monitor-agent","title":"Syslog + Azure Monitor Agent","text":"<p>Soluzione per infrastrutture esistenti che utilizzano gi\u00e0 Syslog.</p> <p>Caratteristiche: - Integrazione con infrastrutture Syslog esistenti - Azure Monitor Agent per la raccolta - Configurazione server Syslog richiesta</p> <p>Quando usarla: - Hai gi\u00e0 un'infrastruttura Syslog - Preferisci un approccio basato su agent - Hai requisiti di rete specifici</p>"},{"location":"solutions/other/#third-party-siem-connector","title":"Third-party SIEM Connector","text":"<p>Soluzioni enterprise fornite da vendor terze parti.</p> <p>Caratteristiche: - Soluzioni enterprise complete - Supporto dedicato - Funzionalit\u00e0 avanzate</p> <p>Quando usarla: - Hai bisogno di supporto enterprise - Richiedi funzionalit\u00e0 avanzate specifiche - Budget per soluzioni commerciali</p>"},{"location":"solutions/other/#confronto-soluzioni","title":"Confronto Soluzioni","text":"Soluzione Complessit\u00e0 Costo Personalizzazione CCF Bassa Basso Limitata Azure Function Media Medio Alta Logic App Bassa Medio Media Syslog Media Basso Media Third-party Variabile Alto Variabile"},{"location":"solutions/other/#scelta-della-soluzione","title":"Scelta della Soluzione","text":"<p>Considera i seguenti fattori: - Budget disponibile - Competenze tecniche del team - Requisiti di personalizzazione - Infrastruttura esistente - Requisiti di supporto</p>"},{"location":"solutions/overview/","title":"Panoramica Soluzioni","text":"<p>Questa pagina fornisce un confronto completo di tutte le soluzioni disponibili per integrare Salesforce con Azure Sentinel.</p>"},{"location":"solutions/overview/#soluzioni-disponibili","title":"Soluzioni Disponibili","text":"<p>Il progetto offre 5 soluzioni diverse per soddisfare ogni esigenza:</p> <ol> <li>CodeLess Connector Framework (CCF) - Setup rapido, zero manutenzione</li> <li>Azure Function - Massima personalizzazione</li> <li>Azure Logic App - Low-code visuale</li> <li>Syslog + Azure Monitor Agent - Per infrastrutture esistenti</li> <li>Third-party SIEM Connector - Per soluzioni enterprise</li> </ol>"},{"location":"solutions/overview/#confronto-rapido","title":"Confronto Rapido","text":"Soluzione Complessit\u00e0 Costo Personalizzazione Setup Time CCF Bassa Basso Limitata 15-30 min Azure Function Media Medio Alta 1-2 ore Logic App Bassa Medio Media 30-60 min Syslog Media Basso Media 1-2 ore Third-party Variabile Alto Variabile Variabile"},{"location":"solutions/overview/#come-scegliere","title":"Come Scegliere","text":"<ul> <li>Scegli CCF se: Vuoi setup rapido senza codice, zero manutenzione</li> <li>Scegli Azure Function se: Hai bisogno di personalizzazione avanzata e controllo completo</li> <li>Scegli Logic App se: Preferisci un approccio visuale low-code</li> <li>Scegli Syslog se: Hai gi\u00e0 un'infrastruttura Syslog esistente</li> <li>Scegli Third-party se: Hai bisogno di supporto enterprise e funzionalit\u00e0 avanzate</li> </ul> <p>Per maggiori dettagli, consulta le pagine specifiche di ogni soluzione o il repository GitHub.</p>"}]}